<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPlaywright - ãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: "âš™ï¸";
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        input[type="url"], input[type="file"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        input[type="url"]:focus, input[type="file"]:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .buttons-section h2::before {
            content: "ğŸš€";
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        /* æœ€åˆã®2è¡Œã¯2åˆ—ã€æœ€å¾Œã®è¡Œã¯1åˆ—ï¼ˆä¸­å¤®é…ç½®ï¼‰ */
        .button-grid button:nth-child(1),
        .button-grid button:nth-child(2) {
            /* æœ€åˆã®è¡Œ */
        }
        
        .button-grid button:nth-child(3),
        .button-grid button:nth-child(4) {
            /* 2è¡Œç›® */
        }
        
        .button-grid button:nth-child(5) {
            /* 3è¡Œç›®ã€ä¸­å¤®é…ç½® */
            grid-column: 2;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }
        
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }
        
        .manual-guide-btn {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .user-story-info {
            margin-top: 5px;
        }
        
        .user-story-id {
            background: linear-gradient(135deg, #e8f5e8, #d1edcc);
            border: 2px solid #4caf50;
            border-radius: 8px;
            padding: 10px;
            margin-top: 8px;
            color: #2e7d32;
            font-weight: 600;
            text-align: center;
        }
        
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
            text-align: center;
            max-height: 100px;
            overflow: hidden;
            word-wrap: break-word;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            z-index: 1001;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 30px;
            line-height: 1.6;
        }
        
        .modal-body h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .modal-body h3:first-child {
            margin-top: 0;
        }
        
        .modal-body pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            font-size: 14px;
            margin: 15px 0;
        }
        
        .modal-body code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .modal-body ul, .modal-body ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
        }
        
        .highlight-box {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }

        /* ä¿®æ­£ãƒ«ãƒ¼ãƒˆä¸€è¦§ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .fixed-route-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .route-item {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .route-item h4 {
            margin: 0;
            color: #495057;
            font-size: 14px;
        }

        .route-item p {
            margin: 0;
            font-size: 12px;
            color: #6c757d;
        }

        .route-item button {
            align-self: flex-start;
            padding: 6px 12px;
            font-size: 12px;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        /* ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .test-summary {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #28a745;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
        }
        
        .test-summary h3 {
            margin: 0 0 15px 0;
            color: #155724;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #6c757d;
        }
        
        .summary-item.success {
            border-left-color: #28a745;
        }
        
        .summary-item.error {
            border-left-color: #dc3545;
        }
        
        .summary-label {
            font-weight: 600;
            color: #495057;
        }
        
        .summary-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        
        .failed-tests {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .failed-tests h4 {
            margin: 0 0 10px 0;
            color: #721c24;
            font-size: 1rem;
        }
        
        .failed-tests ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .failed-tests li {
            background: white;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            color: #721c24;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .failed-tests li:last-child {
            margin-bottom: 0;
        }
        
        .failed-tests li::before {
            content: "âŒ ";
            font-weight: bold;
            margin-right: 5px;
        }
        
        /* AIè¨­å®šãƒ‘ãƒãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .ai-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .ai-config-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .ai-config-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .form-group input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
        
        .form-group input[type="number"] {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
            background-color: white;
        }
        
        .form-group select:focus,
        .form-group input[type="number"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
        
        /* ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-nav {
            display: flex;
            border-bottom: 2px solid #e1e5e9;
            margin-bottom: 30px;
            gap: 5px;
        }
        
        .tab-button {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: #6c757d;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-button:hover {
            color: #007bff;
            background-color: #f8f9fa;
        }
        
        .tab-button.active {
            color: #007bff;
            border-bottom-color: #007bff;
            background-color: #f8f9fa;
        }
        
        /* ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }

        /* æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        .selected-story {
            background: #f8f9fa;
            border: 2px solid #28a745;
            border-radius: 8px;
            padding: 15px;
            margin: 15px 0;
        }

        .story-info {
            display: grid;
            gap: 8px;
        }

        .stories-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .story-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .story-title {
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
        }

        .story-priority {
            font-size: 14px;
            padding: 2px 8px;
            border-radius: 4px;
            display: inline-block;
            margin-bottom: 5px;
        }

        .priority-high {
            background: #ffe6e6;
            color: #d63384;
            border: 1px solid #d63384;
        }

        .priority-medium {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffc107;
        }

        .priority-low {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #17a2b8;
        }

        .story-url {
            font-size: 12px;
            color: #6c757d;
            word-break: break-all;
        }

        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            margin: 10px 0;
        }

        .file-name {
            font-weight: bold;
            color: #333;
        }

        .file-date {
            font-size: 12px;
            color: #6c757d;
        }

        /* ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£IDãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .user-story-id .btn {
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-left: 10px;
            border: 1px solid #6c757d;
            background-color: transparent;
            color: #6c757d;
            text-decoration: none;
            transition: all 0.2s ease;
        }
        
        .user-story-id .btn:hover {
            background-color: #6c757d;
            color: white;
            border-color: #495057;
        }

        /* ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®è‰²ã‚’è–„ãã™ã‚‹ */
        input::placeholder,
        textarea::placeholder {
            color: #c6c6c6 !important;
            opacity: 1;
        }
        
        /* Androidå®Ÿæ©Ÿè¨­å®šã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .adb-status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .adb-status.connected {
            background: #d4edda;
            color: #155724;
        }
        
        .adb-status.disconnected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .adb-status.checking {
            background: #fff3cd;
            color: #856404;
        }
        
        .android-info {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .android-info h4 {
            margin: 0 0 8px 0;
            color: #1976d2;
        }
        
        .android-info ul {
            margin: 0;
            padding-left: 20px;
            color: #1565c0;
        }
        
        /* Firefoxç”¨ */
        input::-moz-placeholder,
        textarea::-moz-placeholder {
            color: #c6c6c6 !important;
            opacity: 1;
        }
        
        /* WebKitç³»ãƒ–ãƒ©ã‚¦ã‚¶ç”¨ */
        input::-webkit-input-placeholder,
        textarea::-webkit-input-placeholder {
            color: #c6c6c6 !important;
        }
        
        /* Microsoft Edgeç”¨ */
        input::-ms-input-placeholder,
        textarea::-ms-input-placeholder {
            color: #c6c6c6 !important;
        }

        /* ä¸€æ‹¬å®Ÿè¡Œãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .bulk-execution-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 8px 32px rgba(102, 126, 234, 0.3);
        }

        .btn-bulk-execution {
            background: linear-gradient(135deg, #ff6b6b, #feca57);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
            margin-bottom: 10px;
        }

        .btn-bulk-execution:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 25px rgba(255, 107, 107, 0.4);
        }

        .btn-bulk-execution:active {
            transform: translateY(0);
        }

        .bulk-execution-description {
            color: white;
            font-size: 14px;
            margin-top: 10px;
            opacity: 0.9;
        }

        .bulk-status {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .bulk-progress {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .progress-step {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .progress-step.active {
            background: #feca57;
            color: #333;
            transform: scale(1.05);
        }

        .progress-step.completed {
            background: #2ecc71;
            color: white;
        }

        .progress-step.error {
            background: #e74c3c;
            color: white;
        }

        .bulk-current-action {
            color: white;
            font-weight: bold;
            font-size: 16px;
        }

        /* ä¸€æ‹¬å®Ÿè¡Œã®ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ */
        @media (max-width: 768px) {
            .bulk-execution-section {
                margin: 15px 0;
                padding: 15px;
            }
            
            .btn-bulk-execution {
                padding: 12px 20px;
                font-size: 16px;
            }
            
            .bulk-execution-description {
                font-size: 12px;
            }
            
            .bulk-progress {
                gap: 8px;
            }
            
            .progress-step {
                padding: 6px 10px;
                font-size: 12px;
            }
            
            .bulk-current-action {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AutoPlaywright</h1>
            <p>Playwrightã‚’ä½¿ç”¨ã—ãŸE2Eãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</p>
        </div>
        
        <div class="content">
            <!-- åŸºæœ¬è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå…±é€šï¼‰ -->
            <div class="section">
                <h2>åŸºæœ¬è¨­å®š</h2>
                
                <div class="form-group">
                    <label for="testUrl">ãƒ†ã‚¹ãƒˆå¯¾è±¡URL:</label>
                    <input type="url" id="testUrl" placeholder="https://example.com" value="">
                </div>
                
                <div class="form-group">
                    <label for="testGoal">ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ä¸»ãªãƒ«ãƒ¼ãƒˆ:</label>
                    <textarea id="testGoal" rows="3" placeholder="ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼šå®¿æ³Šäºˆç´„ã®å…¥åŠ›ãƒ»é¸æŠãŒã§ãã‚‹&#10;ãƒ«ãƒ¼ãƒˆï¼šã€å®¿æ³Šäºˆç´„ç”»é¢ã§å„é …ç›®ã«æœ‰åŠ¹ãªå€¤ã‚’å…¥åŠ›ã€ã¾ãŸã¯é¸æŠã—ã¦ã€Œäºˆç´„å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã€ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ã€ã€Œå®¿æ³Šäºˆç´„ç¢ºèªã€ç”»é¢ã«å€¤ãŒåæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹"></textarea>
                    <div class="user-story-info">
                        <small>å…·ä½“çš„ãªãƒ†ã‚¹ãƒˆæ‰‹é †ã‚„ç¢ºèªã—ãŸã„å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„</small>
                        
                        <!-- AIä¿®æ­£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                        <div class="ai-fix-option" style="margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 6px; border-left: 4px solid #007bff;">
                            <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer; font-weight: 500;">
                                <input type="checkbox" id="enableAIFix" style="margin-right: 8px; transform: scale(1.2);">
                                <span>ğŸ¤– å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ä¿®æ­£ã‚’AIã«ä»»ã›ã‚‹</span>
                            </label>
                            <small style="display: block; margin-top: 5px; color: #6c757d;">
                                ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã™ã¨ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ä¿®æ­£ã®ã¿ä½¿ç”¨ï¼ˆã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ»å®‰å®šæ€§å‘ä¸Šï¼‰
                            </small>
                        </div>
                        
                        <!-- æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿æŒ‡å®šã‚ªãƒ—ã‚·ãƒ§ãƒ³ -->
                        <div class="manual-selector-option" id="manualSelectorOption" style="display: none; margin: 10px 0; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 4px solid #ffc107;">
                            <label class="checkbox-label" style="display: flex; align-items: center; cursor: pointer; font-weight: 500;">
                                <input type="checkbox" id="enableManualSelector" style="margin-right: 8px; transform: scale(1.2);">
                                <span>ğŸ¯ è¦ç´ æŒ‡å®šã‚µãƒãƒ¼ãƒˆï¼ˆå¤±æ•—åˆ†ææ™‚ã®ã¿ï¼‰</span>
                            </label>
                            <small style="display: block; margin-top: 5px; color: #856404;">
                                å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®è¦ç´ ã‚’å®Ÿéš›ã®ç”»é¢ã§ç¢ºèªã—ã¦æŒ‡å®šã§ãã¾ã™
                            </small>
                            
                            <div id="manualSelectorDetails" style="display: none; margin-top: 10px;">
                                <div style="background: #f8f9fa; padding: 10px; border-radius: 4px; margin-bottom: 10px;">
                                    <h5 style="margin: 0 0 8px 0; color: #495057;">ğŸ” è¦ç´ æŒ‡å®šæ–¹æ³•</h5>
                                    <p style="margin: 0; font-size: 13px; color: #6c757d;">
                                        <strong>æ–¹æ³•1: F12ã‚»ãƒ¬ã‚¯ã‚¿ç›´æ¥å…¥åŠ›ï¼ˆæ¨å¥¨ï¼‰</strong><br>
                                        1. è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæ¤œè¨¼ã€<br>
                                        2. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€ŒCopyã€â†’ ã€ŒCopy selectorã€<br>
                                        3. ä¸‹è¨˜ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘<br><br>
                                        <strong>æ–¹æ³•2: JSONå½¢å¼å…¥åŠ›</strong><br>
                                        å¾“æ¥ã®JSONå½¢å¼ã§ã‚‚å…¥åŠ›å¯èƒ½
                                    </p>
                                </div>
                                
                                <!-- F12ã‚»ãƒ¬ã‚¯ã‚¿ç›´æ¥å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ -->
                                <div style="margin-bottom: 15px;">
                                    <label style="font-weight: 500; display: block; margin-bottom: 5px;">
                                        ğŸ¯ F12ã‚»ãƒ¬ã‚¯ã‚¿ç›´æ¥å…¥åŠ›ï¼ˆæ¨å¥¨ï¼‰
                                    </label>
                                    <div style="display: flex; gap: 10px; margin-bottom: 10px;">
                                        <input type="text" id="f12SelectorInput" placeholder="F12ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ã‚’è²¼ã‚Šä»˜ã‘..." 
                                               style="flex: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace;">
                                        <input type="text" id="f12SelectorLabel" placeholder="è¦ç´ ã®åå‰ï¼ˆä¾‹: æ¸‹è°·ãƒœã‚¿ãƒ³ï¼‰" 
                                               style="width: 200px; padding: 8px; border: 1px solid #ddd; border-radius: 4px;">
                                        <button type="button" id="addF12Selector" style="padding: 8px 15px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                            â• è¿½åŠ 
                                        </button>
                                    </div>
                                    <div id="f12SelectorPreview" style="background: #f8f9fa; padding: 10px; border-radius: 4px; font-family: monospace; font-size: 12px; color: #6c757d; min-height: 20px;">
                                        ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢
                                    </div>
                                </div>

                                <label style="font-weight: 500; display: block; margin-bottom: 5px;">
                                    ğŸ“ æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿è¨­å®šï¼ˆJSONå½¢å¼ï¼‰
                                </label>
                                <textarea id="manualSelectorJson" style="width: 100%; height: 120px; font-family: monospace; font-size: 12px; border: 1px solid #ced4da; border-radius: 4px; padding: 8px;"
                                    placeholder='ä¾‹ï¼ˆF12ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ã‚‚ä½¿ç”¨å¯èƒ½ï¼‰:
{
  "ã‚¨ãƒªã‚¢é¸æŠ": {
    "æ¸‹è°·": "#__next > div:nth-child(2) > main > div > div.shops_inner__g55WC > div > div.shops_columnLeft__Ki5VN > div > div.SearchInput_sort__newQ4 > div.md\\:none > div > div > div > div > div._SearchItem_form__Nx_1C > div:nth-child(11) > div:nth-child(1) > div._SearchItem_itemSub__Y7NMw._SearchItem_areaSub__66bQd > label:nth-child(1)",
    "æµæ¯”å¯¿": "text=æµæ¯”å¯¿"
  },
  "ãƒœã‚¿ãƒ³": {
    "ã“ã®æ¡ä»¶ã§çµã‚Šè¾¼ã‚€": "button:has-text(\"çµã‚Šè¾¼ã‚€\")"
  }
}'></textarea>
                                <div style="margin-top: 8px; display: flex; gap: 10px;">
                                    <button type="button" id="validateSelectors" style="background: #17a2b8; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                        âœ… å½¢å¼ãƒã‚§ãƒƒã‚¯
                                    </button>
                                    <button type="button" id="clearSelectors" style="background: #6c757d; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                                    </button>
                                    <button type="button" id="helpSelectors" style="background: #28a745; color: white; border: none; padding: 5px 10px; border-radius: 4px; font-size: 12px;">
                                        â“ ä½¿ã„æ–¹
                                    </button>
                                </div>
                                <div id="selectorValidationResult" style="margin-top: 8px; font-size: 12px;"></div>
                            </div>
                        </div>
                        
                        <div id="userStoryId" class="user-story-id" style="display: none;">
                            ğŸ”— <strong>ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ID:</strong> <span id="currentUserStoryId">-</span>
                            <button type="button" class="btn" onclick="resetTestHistory()">
                                éå»ã®ãƒ†ã‚¹ãƒˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="csvFile">ãƒ†ã‚¹ãƒˆè¦³ç‚¹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆCSV (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <input type="file" id="csvFile" accept=".csv">
                    <small>æŒ‡å®šã—ãªã„å ´åˆã¯æ¨™æº–ã®ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’ä½¿ç”¨ã—ã¾ã™</small>
                </div>
                
                <div class="form-group">
                    <label for="pdfFile">ä»•æ§˜æ›¸PDF (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <input type="file" id="pdfFile" accept=".pdf">
                </div>
            </div>
            
            <!-- å®Ÿè¡Œç’°å¢ƒé¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ“± å®Ÿè¡Œç’°å¢ƒé¸æŠ</h2>
                
                <div class="form-group">
                    <label for="executionEnvironment">ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ:</label>
                    <select id="executionEnvironment" onchange="onEnvironmentChange()">
                        <option value="pc">ğŸ–¥ï¸ PCç‰ˆãƒ–ãƒ©ã‚¦ã‚¶ (æ¨™æº–)</option>
                        <option value="android">ğŸ“± Androidå®Ÿæ©Ÿ (CDPæ¥ç¶š)</option>
                    </select>
                    <small>Androidå®Ÿæ©Ÿã‚’é¸æŠã™ã‚‹å ´åˆã¯ã€äº‹å‰ã«ADBãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰ã®è¨­å®šãŒå¿…è¦ã§ã™</small>
                </div>
                
                <!-- Androidå®Ÿæ©Ÿå°‚ç”¨è¨­å®š -->
                <div id="androidSettings" style="display: none;">
                    <div class="form-group">
                        <label for="domAnalysisSource">DOMè§£æå…ƒ:</label>
                        <select id="domAnalysisSource">
                            <option value="pc">ğŸ–¥ï¸ PCç‰ˆã§è§£æ (æ¨å¥¨)</option>
                            <option value="android">ğŸ“± Androidå®Ÿæ©Ÿã§è§£æ</option>
                        </select>
                        <small>PCç‰ˆã®æ–¹ãŒè¦ç´ æ¤œå‡ºãŒå®‰å®šã—ã¦ã„ã¾ã™</small>
                    </div>
                    
                    <div class="form-group">
                        <label>ADBæ¥ç¶šç¢ºèª:</label>
                        <div style="display: flex; gap: 10px; align-items: center; margin-top: 8px;">
                            <button type="button" class="btn-info" onclick="checkADBConnection()" style="padding: 8px 16px; font-size: 14px;">
                                ğŸ” æ¥ç¶šç¢ºèª
                            </button>
                            <button type="button" class="btn-secondary" onclick="setupADBForward()" style="padding: 8px 16px; font-size: 14px;">
                                ğŸ”§ ADBè¨­å®š
                            </button>
                            <div id="adbStatus" class="adb-status" style="font-size: 14px; font-weight: 600;"></div>
                        </div>
                        <small>Androidå®Ÿæ©Ÿã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰ã«æ¥ç¶šã‚’ç¢ºèªã—ã¦ãã ã•ã„</small>
                    </div>
                    
                    <div class="android-info" style="background: #e3f2fd; border-left: 4px solid #2196f3; padding: 15px; margin: 15px 0; border-radius: 0 8px 8px 0;">
                        <h4 style="margin: 0 0 8px 0; color: #1976d2;">ğŸ“± Androidå®Ÿæ©Ÿãƒ†ã‚¹ãƒˆã®ç‰¹å¾´</h4>
                        <ul style="margin: 0; padding-left: 20px; color: #1565c0;">
                            <li>ã‚¹ãƒãƒ›ç‰ˆUIã«ç‰¹åŒ–ã—ãŸè¦ç´ æ¤œå‡º</li>
                            <li>å®Ÿéš›ã®ã‚¿ãƒƒãƒæ“ä½œã«ã‚ˆã‚‹ãƒ†ã‚¹ãƒˆ</li>
                            <li>PCç‰ˆã¨ã¯ç•°ãªã‚‹UIæ§‹é€ ã«å¯¾å¿œ</li>
                            <li>è¡¨ç¤ºç¢ºèªãƒ†ã‚¹ãƒˆãŒæœ€ã‚‚å®‰å®š</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- ä¸€æ‹¬å®Ÿè¡Œãƒœã‚¿ãƒ³ -->
            <div class="bulk-execution-section">
                <button class="btn-bulk-execution" onclick="executeBulkWorkflow()">
                    ğŸš€ è‡ªå‹•ã§ä¸€æ‹¬å®Ÿè¡Œã™ã‚‹
                </button>
                <div class="bulk-execution-description">
                    è¦³ç‚¹ç”Ÿæˆ â†’ ã‚·ãƒŠãƒªã‚ªç”Ÿæˆ â†’ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ â†’ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ â†’ å¤±æ•—åˆ†æ â†’ å†ãƒˆãƒ©ã‚¤ â†’ æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ã‚’è‡ªå‹•å®Ÿè¡Œ
                </div>
                
                <!-- ä¸€æ‹¬å®Ÿè¡Œã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ -->
                <div id="bulkStatus" class="bulk-status" style="display: none;">
                    <div class="bulk-progress">
                        <div class="progress-step" id="step-testpoints">ğŸ“‹ è¦³ç‚¹ç”Ÿæˆ</div>
                        <div class="progress-step" id="step-testcases">ğŸ§  ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆ</div>
                        <div class="progress-step" id="step-routes">ğŸ­ Playwrightå¤‰æ›</div>
                        <div class="progress-step" id="step-run">â–¶ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</div>
                        <div class="progress-step" id="step-report">ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ</div>
                        <div class="progress-step" id="step-analyze">ğŸ”§ å¤±æ•—åˆ†æ</div>
                        <div class="progress-step" id="step-retry">ğŸš€ å†ãƒˆãƒ©ã‚¤</div>
                        <div class="progress-step" id="step-stories">ğŸ” æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹</div>
                    </div>
                    <div class="bulk-current-action" id="bulkCurrentAction">æº–å‚™ä¸­...</div>
                </div>
            </div>
            
            <!-- ã‚¿ãƒ–ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="tab-nav">
                <button class="tab-button active" onclick="switchTab('test-execution')">ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
                <button class="tab-button" onclick="switchTab('auto-improvement')">ğŸ¤– è‡ªå‹•æ”¹å–„ãƒ»å­¦ç¿’æ©Ÿèƒ½</button>
                <button class="tab-button" onclick="switchTab('new-stories')">ğŸ“– æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼</button>
            </div>
            
            <!-- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¿ãƒ– -->
            <div id="test-execution" class="tab-content active">
                <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="section buttons-section">
                <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
                
                <div class="button-grid">
                    <button class="btn-primary" onclick="executeCommand('generateTestPoints')">
                        ğŸ“‹ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ
                    </button>
                    
                    <button class="btn-secondary" onclick="executeCommand('generateTestCases')" title="ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’ã‚ˆã‚Šå…·ä½“çš„ãªè‡ªç„¶è¨€èªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã«ç”Ÿæˆ">
                        ğŸ§  ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆ
                    </button>
                    
                    <button class="btn-info" onclick="executeCommand('generateSmartRoutes')">
                        ğŸ­ Playwrightç”¨ã«å¤‰æ›
                    </button>
                    
                    <button class="btn-success" onclick="executeCommand('runRoutes')">
                        â–¶ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    </button>
                    
                    <button class="btn-warning" onclick="executeCommand('generateTestReport')">
                        ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </button>
                </div>
                

                
                <div id="status" class="status" style="display: none;"></div>
                
                <!-- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ -->
                <div id="testSummary" class="test-summary" style="display: none;">
                    <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">ğŸ”· ãƒ†ã‚¹ãƒˆID:</span>
                            <span id="testId" class="summary-value">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:</span>
                            <span id="totalSteps" class="summary-value">-</span>
                        </div>
                        <div class="summary-item success">
                            <span class="summary-label">âœ… æˆåŠŸæ•°:</span>
                            <span id="successCount" class="summary-value">-</span>
                        </div>
                        <div class="summary-item error">
                            <span class="summary-label">âŒ å¤±æ•—æ•°:</span>
                            <span id="failureCount" class="summary-value">-</span>
                        </div>
                    </div>
                    <div id="failedTests" class="failed-tests" style="display: none;">
                        <h4>âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:</h4>
                        <ul id="failedTestsList"></ul>
                    </div>
                </div>
                
                <div class="log-area" id="logArea">
                    å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                </div>
            </div>
            
            <!-- AIè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ¤– AIè¨­å®š</h2>
                
                <div class="ai-config-grid">
                    <div class="form-group">
                        <label for="aiModel">ãƒ¢ãƒ‡ãƒ«:</label>
                        <select id="aiModel">
                            <option value="gpt-4o-mini">GPT-4o Mini (æ¨å¥¨)</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiTemperature">å‰µé€ æ€§ (Temperature): <span id="temperatureValue">0.5</span></label>
                        <input type="range" id="aiTemperature" min="0" max="1" step="0.1" value="0.5">
                        <small>0.0: æ±ºå®šçš„, 1.0: å‰µé€ çš„</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiMaxTokens">æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°:</label>
                        <input type="number" id="aiMaxTokens" min="1000" max="8000" step="500" value="4000">
                        <small>1000-8000 (å¤šã„ã»ã©è©³ç´°ãªå›ç­”)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiTopP">Top-p: <span id="topPValue">0.9</span></label>
                        <input type="range" id="aiTopP" min="0.1" max="1" step="0.1" value="0.9">
                        <small>0.1: é›†ä¸­çš„, 1.0: å¤šæ§˜æ€§</small>
                    </div>
                </div>
                
                <div class="ai-config-actions">
                    <button type="button" class="btn-secondary" onclick="resetAIConfig()">
                        ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                    </button>
                    <button type="button" class="btn-primary" onclick="saveAIConfig()">
                        ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                    </button>
                </div>
            </div>

            
                <!-- æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="section">
                    <h2>ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä½œæˆ</h2>
                    
                    <div class="form-group">
                        <button type="button" class="btn-info manual-guide-btn" onclick="showManualGuide()">
                            ğŸ“‹ æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ä½œæˆã™ã‚‹æ–¹æ³•
                        </button>
                        <small>AIãŒç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã«æº€è¶³ã§ããªã„å ´åˆã®ä»£æ›¿æ‰‹æ®µ</small>
                    </div>
                </div>
            </div>
            
            <!-- è‡ªå‹•æ”¹å–„ãƒ»å­¦ç¿’æ©Ÿèƒ½ã‚¿ãƒ– -->
            <div id="auto-improvement" class="tab-content">
                <!-- è‡ªå‹•æ”¹å–„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="section">
                    <h2>ğŸ§  è‡ªå‹•æ”¹å–„ãƒ»å­¦ç¿’æ©Ÿèƒ½</h2>
                    
                    <div class="button-container">
                        <button class="btn btn-warning" onclick="executeCommand('analyzeFailures')">
                            ğŸ”§ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®åˆ†æã¨ä¿®æ­£
                        </button>
                        <button class="btn btn-success" onclick="showFixedRouteModal()">
                            ğŸš€ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®å†ãƒˆãƒ©ã‚¤
                        </button>
                    </div>
                    
                    <div id="statusAI" class="status" style="display: none;"></div>
                    
                    <!-- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ï¼ˆè‡ªå‹•æ”¹å–„ç”¨ï¼‰ -->
                    <div id="testSummaryAI" class="test-summary" style="display: none;">
                        <h3>ğŸ“Š è‡ªå‹•æ”¹å–„å®Ÿè¡Œçµæœ</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">ğŸ”· ãƒ†ã‚¹ãƒˆID:</span>
                                <span id="testIdAI" class="summary-value">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:</span>
                                <span id="totalStepsAI" class="summary-value">-</span>
                            </div>
                            <div class="summary-item success">
                                <span class="summary-label">âœ… æˆåŠŸæ•°:</span>
                                <span id="successCountAI" class="summary-value">-</span>
                            </div>
                            <div class="summary-item error">
                                <span class="summary-label">âŒ å¤±æ•—æ•°:</span>
                                <span id="failureCountAI" class="summary-value">-</span>
                            </div>
                        </div>
                        <div id="failedTestsAI" class="failed-tests" style="display: none;">
                            <h4>âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:</h4>
                            <ul id="failedTestsListAI"></ul>
                        </div>
                    </div>
                    
                    <div class="log-area" id="logAreaAI">
                        è‡ªå‹•æ”¹å–„å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                    </div>
                    
                    <div class="description">
                        <h4>ğŸ¤– å­¦ç¿’æ©Ÿèƒ½ã®ç‰¹å¾´:</h4>
                        <ul>
                            <li><strong>å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³å­¦ç¿’</strong>: éå»ã®å¤±æ•—ã‚’è¨˜éŒ²ã—ã€åŒã˜ãƒŸã‚¹ã‚’å›é¿</li>
                            <li><strong>ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼å‚ç…§</strong>: ä¸Šè¨˜ã§å…¥åŠ›ã•ã‚ŒãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’è€ƒæ…®ã—ã¦é‡è¦ãªè¦ç´ ã‚’ç‰¹å®š</li>
                            <li><strong>ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä¿®æ­£</strong>: PDFä»•æ§˜æ›¸ã‚„CSVè¦³ç‚¹ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚å‚ç…§ã—ã¦é©åˆ‡ãªä¿®æ­£ã‚’ææ¡ˆ</li>
                            <li><strong>ä»£æ›¿ã‚»ãƒ¬ã‚¯ã‚¿ææ¡ˆ</strong>: è¦ç´ ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã®ä»£æ›¿æ¡ˆã‚’ç”Ÿæˆ</li>
                            <li><strong>ä¿®æ­£ãƒ«ãƒ¼ãƒˆç”Ÿæˆ</strong>: å¤±æ•—åŸå› ã‚’è§£æã—ã€ä¿®æ­£ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆã‚’è‡ªå‹•ä½œæˆ</li>
                        </ul>
                        <div class="highlight-box">
                            <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> å¤±æ•—åˆ†æå®Ÿè¡Œæ™‚ã«ä¸Šè¨˜ã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼/ãƒ†ã‚¹ãƒˆç›®æ¨™ã€ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚Œã°ã€
                            ãã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®è¦³ç‚¹ã‹ã‚‰é‡è¦ãªè¦ç´ ã‚’åˆ¤å®šã—ã€ã‚¹ã‚­ãƒƒãƒ—ã§ã¯ãªãä»£æ›¿æ‰‹æ®µã‚’æ¨¡ç´¢ã—ã¾ã™ï¼
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ– -->
            <div id="new-stories" class="tab-content">
                <!-- æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div class="section">
                    <h2>ğŸ“– æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ãƒ»å®Ÿè¡Œ</h2>
                    
                    <div class="button-container">
                        <button class="btn btn-info" onclick="executeCommand('discoverNewStories')">
                            ğŸ” æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹
                        </button>
                        <button class="btn btn-success" onclick="showDiscoveredStoriesModal()">
                            ğŸ“‹ ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠ
                        </button>
                    </div>
                    
                    <div id="statusNewStories" class="status" style="display: none;"></div>
                    
                    <!-- é¸æŠã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼è¡¨ç¤º -->
                    <div id="selectedStoryDisplay" class="selected-story" style="display: none;">
                        <h3>ğŸ¯ é¸æŠã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼</h3>
                        <div class="story-info">
                            <p><strong>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼:</strong> <span id="selectedStoryText">-</span></p>
                            <p><strong>å„ªå…ˆåº¦:</strong> <span id="selectedStoryPriority">-</span></p>
                            <p><strong>æ¨å¥¨URL:</strong> <span id="selectedStoryUrl">-</span></p>
                        </div>
                    </div>
                    
                    <!-- æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒœã‚¿ãƒ³ -->
                    <div class="section">
                        <h3>ğŸš€ æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h3>
                        <div class="button-container">
                            <button class="btn btn-primary" onclick="executeNewStoryCommand('generateTestPoints')">
                                ğŸ“ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ
                            </button>
                            <button class="btn btn-secondary" onclick="executeNewStoryCommand('generateTestCases')">
                                ğŸ§  ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆ
                            </button>
                            <button class="btn btn-info" onclick="executeNewStoryCommand('generateSmartRoutes')">
                                ğŸ­ Playwrightç”¨ã«å¤‰æ›
                            </button>
                            <button class="btn btn-success" onclick="executeNewStoryCommand('runRoutes')">
                                â–¶ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                            </button>
                            <button class="btn btn-warning" onclick="executeNewStoryCommand('generateTestReport')">
                                ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                            </button>
                        </div>
                    </div>
                    
                    <!-- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ï¼ˆæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”¨ï¼‰ -->
                    <div id="testSummaryNewStories" class="test-summary" style="display: none;">
                        <h3>ğŸ“Š æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆçµæœ</h3>
                        <div class="summary-grid">
                            <div class="summary-item">
                                <span class="summary-label">ğŸ”· ãƒ†ã‚¹ãƒˆID:</span>
                                <span id="testIdNewStories" class="summary-value">-</span>
                            </div>
                            <div class="summary-item">
                                <span class="summary-label">ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:</span>
                                <span id="totalStepsNewStories" class="summary-value">-</span>
                            </div>
                            <div class="summary-item success">
                                <span class="summary-label">âœ… æˆåŠŸæ•°:</span>
                                <span id="successCountNewStories" class="summary-value">-</span>
                            </div>
                            <div class="summary-item error">
                                <span class="summary-label">âŒ å¤±æ•—æ•°:</span>
                                <span id="failureCountNewStories" class="summary-value">-</span>
                            </div>
                        </div>
                        <div id="failedTestsNewStories" class="failed-tests" style="display: none;">
                            <h4>âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:</h4>
                            <ul id="failedTestsListNewStories"></ul>
                        </div>
                    </div>
                    
                    <div class="log-area" id="logAreaNewStories">
                        æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                    </div>
                    
                    <div class="description">
                        <h4>ğŸ“– æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ©Ÿèƒ½ã®ç‰¹å¾´:</h4>
                        <ul>
                            <li><strong>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼è‡ªå‹•ç™ºè¦‹</strong>: éå»ã®ãƒ†ã‚¹ãƒˆçµæœã‚’åˆ†æã—ã¦æ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç™ºè¦‹</li>
                            <li><strong>å„ªå…ˆåº¦åˆ¤å®š</strong>: AIãŒé‡è¦åº¦ã‚’åˆ¤å®šã—ã€é«˜å„ªå…ˆåº¦ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å„ªå…ˆè¡¨ç¤º</li>
                            <li><strong>ã‚·ãƒ¼ãƒ ãƒ¬ã‚¹å®Ÿè¡Œ</strong>: ç™ºè¦‹ã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ãã®ã¾ã¾æ–°ã—ã„ãƒ†ã‚¹ãƒˆã¨ã—ã¦å®Ÿè¡Œ</li>
                            <li><strong>å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼</strong>: è¦³ç‚¹ç”Ÿæˆâ†’ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆâ†’Playwrightå¤‰æ›â†’å®Ÿè¡Œâ†’ãƒ¬ãƒãƒ¼ãƒˆä½œæˆã¾ã§ä¸€è²«ã—ãŸå®Ÿè¡ŒãŒå¯èƒ½</li>
                        </ul>
                        <div class="highlight-box">
                            <strong>ğŸ’¡ ä½¿ã„æ–¹:</strong> 
                            1. ã€Œæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ã€ã§æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç™ºè¦‹ â†’ 
                            2. ã€Œç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠã€ã§ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠ â†’ 
                            3. è¦³ç‚¹ç”Ÿæˆâ†’ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆâ†’å¤‰æ›â†’å®Ÿè¡Œã®é †ç•ªã§å®Ÿè¡Œï¼
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="manualGuideModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>ğŸ“‹ æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ä½œæˆã™ã‚‹æ–¹æ³•</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ğŸ¯ æ¦‚è¦</h3>
                <p>AIãŒç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã«æº€è¶³ã§ããªã„å ´åˆã€æ‰‹å‹•ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã‚ˆã‚Šç²¾å¯†ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</p>
                
                <div class="highlight-box">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> æ‰‹å‹•ä½œæˆã«ã‚ˆã‚Šã€AIã§ã¯å¯¾å¿œã§ããªã„è¤‡é›‘ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚„ç‰¹å®šã®è¦ç´ ã‚’æ­£ç¢ºã«ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚
                </div>

                <h3>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®å ´æ‰€</h3>
                <p>ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ‰‹å‹•ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                <pre><code>test-results/route_yymmddhhmmss.json</code></pre>
                <p>ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼ï¼š<code>route_</code> + å¹´æœˆæ—¥æ™‚åˆ†ç§’ + <code>.json</code></p>
                <p>ä¾‹ï¼š<code>route_250623145230.json</code> (2025å¹´06æœˆ23æ—¥ 14æ™‚52åˆ†30ç§’)</p>

                <h3>ğŸ“ JSONæ§‹é€ </h3>
                <p>ä»¥ä¸‹ã®æ§‹é€ ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                <pre><code>{
  "route_id": "manual_test_001",
  "steps": [
    {
      "label": "ã‚¹ãƒ†ãƒƒãƒ—ã®èª¬æ˜",
      "action": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å",
      "target": "ã‚»ãƒ¬ã‚¯ã‚¿ã¾ãŸã¯URL",
      "value": "å…¥åŠ›å€¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
    }
  ]
}</code></pre>

                <h3>ğŸ”§ åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                <ul>
                    <li><code>load</code> - ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€</li>
                    <li><code>click</code> - è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹</li>
                    <li><code>fill</code> - å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’å…¥åŠ›ã™ã‚‹</li>
                    <li><code>assertVisible</code> - è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹</li>
                    <li><code>assertNotVisible</code> - è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹</li>
                    <li><code>waitForSelector</code> - è¦ç´ ãŒç¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹</li>
                    <li><code>waitForURL</code> - ç‰¹å®šã®URLã«é·ç§»ã™ã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹</li>
                </ul>

                <h3>ğŸ“‹ å®Œå…¨ãªä¾‹</h3>
                <pre><code>{
  "route_id": "manual_login_test",
  "steps": [
    {
      "label": "ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’é–‹ã",
      "action": "load",
      "target": "https://example.com/login"
    },
    {
      "label": "ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›",
      "action": "fill",
      "target": "input[name='username']",
      "value": "testuser"
    },
    {
      "label": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›",
      "action": "fill",
      "target": "input[name='password']",
      "value": "testpass123"
    },
    {
      "label": "ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯",
      "action": "click",
      "target": "button[type='submit']"
    },
    {
      "label": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã«é·ç§»ç¢ºèª",
      "action": "waitForURL",
      "target": "**/dashboard**"
    },
    {
      "label": "ã‚ˆã†ã“ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª",
      "action": "assertVisible",
      "target": ".welcome-message"
    }
  ]
}</code></pre>

                <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
                <div class="warning-box">
                    <ul>
                        <li>JSONã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„</li>
                        <li>ã‚»ãƒ¬ã‚¯ã‚¿ã¯å®Ÿéš›ã«ãƒšãƒ¼ã‚¸ã«å­˜åœ¨ã™ã‚‹è¦ç´ ã‚’æŒ‡å®šã—ã¦ãã ã•ã„</li>
                        <li>è¤‡æ•°ã®å€™è£œã‚»ãƒ¬ã‚¯ã‚¿ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§æŒ‡å®šã§ãã¾ã™ï¼ˆä¾‹ï¼š<code>"h1, .title, #main-title"</code>ï¼‰</li>
                        <li>ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å¾Œã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒœã‚¿ãƒ³ã§è‡ªå‹•çš„ã«æœ€æ–°ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™</li>
                    </ul>
                </div>

                <h3>ğŸ” ã‚»ãƒ¬ã‚¯ã‚¿ã®ã‚³ãƒ„</h3>
                <ul>
                    <li><strong>F12ã‚³ãƒ”ãƒ¼ï¼ˆæ¨å¥¨ï¼‰:</strong> é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ Copy â†’ Copy selector</li>
                    <li><strong>IDé¸æŠ:</strong> <code>#element-id</code></li>
                    <li><strong>ã‚¯ãƒ©ã‚¹é¸æŠ:</strong> <code>.class-name</code></li>
                    <li><strong>å±æ€§é¸æŠ:</strong> <code>input[type="email"]</code></li>
                    <li><strong>ãƒ†ã‚­ã‚¹ãƒˆé¸æŠ:</strong> <code>text=ãƒ­ã‚°ã‚¤ãƒ³</code></li>
                    <li><strong>è¤‡åˆé¸æŠ:</strong> <code>form input[type="submit"]</code></li>
                    <li><strong>è¤‡æ•°å€™è£œ:</strong> <code>button, .btn, [type="submit"]</code></li>
                </ul>

                <div class="highlight-box">
                    <strong>ğŸš€ ãƒ—ãƒ­ã®ã‚³ãƒ„:</strong> F12ã®ã€ŒCopy selectorã€æ©Ÿèƒ½ã‚’ä½¿ãˆã°ã€è¤‡é›‘ãªã‚»ãƒ¬ã‚¯ã‚¿ã‚‚ç°¡å˜ã«å–å¾—ã§ãã¾ã™ï¼ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ã‚‚è‡ªå‹•å‡¦ç†ã•ã‚Œã‚‹ã®ã§å®‰å¿ƒã§ã™ã€‚
                </div>
            </div>
        </div>
    </div>

    <!-- ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="fixedRouteModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>ğŸš€ ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œ</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ğŸ¯ æ¦‚è¦</h3>
                <p>å¤±æ•—åˆ†æã§ç”Ÿæˆã•ã‚ŒãŸä¿®æ­£ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦å®Ÿè¡Œã—ã¾ã™ã€‚</p>
                
                <div class="highlight-box">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> ä¿®æ­£ãƒ«ãƒ¼ãƒˆï¼ˆfixed_*ï¼‰ã¯å…ƒã®ãƒ†ã‚¹ãƒˆã®å¤±æ•—ã‚’æ”¹å–„ã—ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ã€‚
                </div>

                <h3>ğŸ“‹ ä¿®æ­£ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§</h3>
                <div id="fixedRouteList">
                    <p>èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>

                <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
                <div class="warning-box">
                    <ul>
                        <li>ä¿®æ­£ãƒ«ãƒ¼ãƒˆã¯å…ƒã®ãƒ†ã‚¹ãƒˆã®å¤±æ•—ã‚’è§£æ±ºã™ã‚‹ç›®çš„ã§ç”Ÿæˆã•ã‚Œã¦ã„ã¾ã™</li>
                        <li>ä¸€éƒ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã€Œã‚¹ã‚­ãƒƒãƒ—ã€ã•ã‚Œã‚‹å ´åˆãŒã‚ã‚Šã¾ã™</li>
                        <li>ä¿®æ­£æˆåŠŸç‡ã¯100%ã§ã¯ã‚ã‚Šã¾ã›ã‚“</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="discoveredStoriesModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>ğŸ“– ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠ</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ğŸ¯ æ¦‚è¦</h3>
                <p>éå»ã«ç™ºè¦‹ã•ã‚ŒãŸæ–°ã—ã„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã®ä¸€è¦§ã‹ã‚‰é¸æŠã—ã¾ã™ã€‚</p>
                
                <div class="highlight-box">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> é¸æŠã—ãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒåŸºæœ¬è¨­å®šã®ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€æ¬„ã«è‡ªå‹•å…¥åŠ›ã•ã‚Œã¾ã™ã€‚
                </div>

                <h3>ğŸ“‹ ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§</h3>
                <div id="discoveredStoriesList">
                    <p>èª­ã¿è¾¼ã¿ä¸­...</p>
                </div>

                <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
                <div class="warning-box">
                    <ul>
                        <li>ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠã™ã‚‹ã¨åŸºæœ¬è¨­å®šã®å†…å®¹ãŒä¸Šæ›¸ãã•ã‚Œã¾ã™</li>
                        <li>æ¨å¥¨URLãŒã‚ã‚‹å ´åˆã¯ã€ãã®URLã«å¤‰æ›´ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™</li>
                        <li>é¸æŠå¾Œã¯ã€Œæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã€ã‚¿ãƒ–ã§ãƒ†ã‚¹ãƒˆå®Ÿè¡ŒãŒå¯èƒ½ã§ã™</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function switchTab(tabId) {
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’éè¡¨ç¤º
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
            });
            
            // ã™ã¹ã¦ã®ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è§£é™¤
            const tabButtons = document.querySelectorAll('.tab-button');
            tabButtons.forEach(button => {
                button.classList.remove('active');
            });
            
            // æŒ‡å®šã•ã‚ŒãŸã‚¿ãƒ–ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º
            const targetTab = document.getElementById(tabId);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // å¯¾å¿œã™ã‚‹ã‚¿ãƒ–ãƒœã‚¿ãƒ³ã‚’ã‚¢ã‚¯ãƒ†ã‚£ãƒ–åŒ–
            const targetButton = document.querySelector(`[onclick="switchTab('${tabId}')"]`);
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }
        
        // ãƒ­ã‚°ã‚¨ãƒªã‚¢ã«è¿½åŠ ã™ã‚‹é–¢æ•°
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ç”¨ã®ãƒ­ã‚°é–¢æ•°
        function addLogAI(message, type = 'info') {
            const logArea = document.getElementById('logAreaAI');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œF12ã‚­ãƒ¼æ©Ÿèƒ½
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12') {
                e.preventDefault();
                
                // ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—ã‚’æ¤œå‡º
                const viewport = window.innerWidth;
                const deviceType = viewport < 768 ? 'mobile' : 'desktop';
                
                console.log(`ğŸ“± ç¾åœ¨ã®ãƒ‡ãƒã‚¤ã‚¹ã‚¿ã‚¤ãƒ—: ${deviceType} (å¹…: ${viewport}px)`);
                
                // ãƒã‚¦ã‚¹ä½ç½®ã‹ã‚‰è¦ç´ ã‚’å–å¾—
                const element = document.elementFromPoint(window.lastMouseX || 0, window.lastMouseY || 0);
                if (element) {
                    const selectors = generateResponsiveSelectors(element, deviceType);
                    console.log('ğŸ¯ ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã‚»ãƒ¬ã‚¯ã‚¿:', selectors);
                    
                    // ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼
                    const selectorText = selectors.map((sel, i) => `${i + 1}. ${sel}`).join('\n');
                    navigator.clipboard.writeText(selectorText).then(() => {
                        alert(`ğŸ“± ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã‚»ãƒ¬ã‚¯ã‚¿ã‚’å–å¾—ã—ã¾ã—ãŸï¼\n\nãƒ‡ãƒã‚¤ã‚¹: ${deviceType}\n\n${selectorText}\n\nâœ… ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«ã‚³ãƒ”ãƒ¼æ¸ˆã¿`);
                    });
                }
            }
        });
        
        // ãƒã‚¦ã‚¹ä½ç½®ã‚’è¿½è·¡
        document.addEventListener('mousemove', function(e) {
            window.lastMouseX = e.clientX;
            window.lastMouseY = e.clientY;
        });
        
        // ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œã‚»ãƒ¬ã‚¯ã‚¿ç”Ÿæˆé–¢æ•°
        function generateResponsiveSelectors(element, deviceType) {
            const selectors = [];
            
            // åŸºæœ¬ã‚»ãƒ¬ã‚¯ã‚¿
            if (element.id) selectors.push(`#${element.id}`);
            if (element.name) selectors.push(`[name="${element.name}"]`);
            
            // ã‚¯ãƒ©ã‚¹ãƒ™ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿ï¼ˆãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œï¼‰
            if (element.className) {
                const classes = element.className.split(' ').filter(c => c.trim());
                classes.forEach(cls => {
                    if (cls.includes('_') && !cls.includes('md:')) {
                        selectors.push(`[class*="${cls}"]`);
                    }
                });
            }
            
            // ãƒ‡ãƒã‚¤ã‚¹å›ºæœ‰ã‚»ãƒ¬ã‚¯ã‚¿
            if (deviceType === 'mobile') {
                // ã‚¹ãƒãƒ›ç‰ˆã§ã¯ã€PCå°‚ç”¨ã‚¯ãƒ©ã‚¹ã‚’é™¤å¤–
                selectors.push(`${element.tagName.toLowerCase()}:not([class*="md:"])`);
            } else {
                // PCç‰ˆã§ã¯ã€è©³ç´°ãªãƒ‘ã‚¹ã‚’å«ã‚ã‚‹
                const fullPath = generateFullPath(element);
                if (fullPath) selectors.push(fullPath);
            }
            
            // ãƒ†ã‚­ã‚¹ãƒˆãƒ™ãƒ¼ã‚¹ã‚»ãƒ¬ã‚¯ã‚¿
            if (element.textContent) {
                const text = element.textContent.trim();
                if (text.length > 0 && text.length < 50) {
                    selectors.push(`text="${text}"`);
                    selectors.push(`${element.tagName.toLowerCase()}:has-text("${text}")`);
                }
            }
            
            // è¦ç´ ã‚¿ã‚¤ãƒ—åˆ¥ã‚»ãƒ¬ã‚¯ã‚¿
            if (element.tagName.toLowerCase() === 'select') {
                selectors.push(`select[name="${element.name}"]`);
            } else if (element.tagName.toLowerCase() === 'input') {
                if (element.type) {
                    selectors.push(`input[type="${element.type}"]`);
                }
            } else if (element.tagName.toLowerCase() === 'button') {
                selectors.push(`button:visible`);
            }
            
            return selectors.filter(s => s && s.length > 0);
        }
        
        // å®Œå…¨ãƒ‘ã‚¹ç”Ÿæˆé–¢æ•°
        function generateFullPath(element) {
            const path = [];
            let current = element;
            
            while (current && current.tagName && path.length < 5) {
                let selector = current.tagName.toLowerCase();
                
                if (current.id) {
                    selector += `#${current.id}`;
                    path.unshift(selector);
                    break;
                }
                
                if (current.className) {
                    const classes = current.className.split(' ').filter(c => c.trim());
                    if (classes.length > 0) {
                        selector += '.' + classes.join('.');
                    }
                }
                
                // nth-child ã®è¿½åŠ 
                if (current.parentNode) {
                    const siblings = Array.from(current.parentNode.children);
                    const sameTagSiblings = siblings.filter(s => s.tagName === current.tagName);
                    if (sameTagSiblings.length > 1) {
                        const index = sameTagSiblings.indexOf(current) + 1;
                        selector += `:nth-child(${index})`;
                    }
                }
                
                path.unshift(selector);
                current = current.parentNode;
            }
            
            return path.join(' > ');
        }
        
        // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ç”¨ã®ãƒ­ã‚°é–¢æ•°
        function addLogNewStories(message, type = 'info') {
            const logArea = document.getElementById('logAreaNewStories');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé–¢æ•°
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            // é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯çŸ­ç¸®ã—ã¦è¡¨ç¤º
            const displayMessage = message.length > 100 ? message.substring(0, 100) + '...' : message;
            statusEl.textContent = displayMessage;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }
        
        // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ç”¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé–¢æ•°
        function showStatusAI(message, type) {
            const statusEl = document.getElementById('statusAI');
            // é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯çŸ­ç¸®ã—ã¦è¡¨ç¤º
            const displayMessage = message.length > 100 ? message.substring(0, 100) + '...' : message;
            statusEl.textContent = displayMessage;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }
        
        // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ç”¨ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé–¢æ•°
        function showStatusNewStories(message, type) {
            const statusEl = document.getElementById('statusNewStories');
            // é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯çŸ­ç¸®ã—ã¦è¡¨ç¤º
            const displayMessage = message.length > 100 ? message.substring(0, 100) + '...' : message;
            statusEl.textContent = displayMessage;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }

        // ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œé–¢æ•°
        async function executeCommand(command) {
            const url = document.getElementById('testUrl').value;
            const testGoal = document.getElementById('testGoal').value;
            const pdfFile = document.getElementById('pdfFile').files[0];
            const csvFile = document.getElementById('csvFile').files[0];
            
            // AIä¿®æ­£ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®çŠ¶æ…‹ã‚’å–å¾—
            const enableAIFix = document.getElementById('enableAIFix').checked;
            
            // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿è¨­å®šã‚’å–å¾—
            const manualSelectors = getManualSelectorSettings();
            
            // å®Ÿè¡Œç’°å¢ƒè¨­å®šã‚’å–å¾—
            const executionEnvironment = document.getElementById('executionEnvironment').value;
            const domAnalysisSource = document.getElementById('domAnalysisSource') ? 
                document.getElementById('domAnalysisSource').value : 'pc';
            
            // è‡ªå‹•æ”¹å–„ã‚³ãƒãƒ³ãƒ‰ã‹ã©ã†ã‹ã‚’åˆ¤å®š
            const isAICommand = command === 'analyzeFailures' || command === 'discoverNewStories';
            const isNewStoriesCommand = false; // executeNewStoryCommand ã§å‡¦ç†
            
            // URLå…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!url && command !== 'runRoutes' && command !== 'generateTestReport' && command !== 'analyzeFailures') {
                if (isAICommand) {
                    showStatusAI('ãƒ†ã‚¹ãƒˆå¯¾è±¡URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                } else {
                    showStatus('ãƒ†ã‚¹ãƒˆå¯¾è±¡URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                }
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£IDã‚’è¡¨ç¤º
            if (testGoal && testGoal.trim()) {
                showUserStoryId();
            }
            
            // AIä¿®æ­£è¨­å®šã®è¡¨ç¤º
            if (command === 'analyzeFailures') {
                if (enableAIFix) {
                    addLogAI(`ğŸ¤– AIä¿®æ­£ãƒ¢ãƒ¼ãƒ‰: æœ‰åŠ¹ (ChatGPTã«ã‚ˆã‚‹å¤±æ•—åˆ†æã‚’å®Ÿè¡Œ)`);
                } else {
                    addLogAI(`ğŸ”§ ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰: æœ‰åŠ¹ (ã‚³ã‚¹ãƒˆå‰Šæ¸›ãƒ»å®‰å®šæ€§é‡è¦–)`);
                }
                
                // å¤±æ•—åˆ†ææ™‚ã®ã¿æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
                showManualSelectorOption();
            }
            
            // ãƒ­ã‚°ã¨ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºã‚’è‡ªå‹•æ”¹å–„ã‚³ãƒãƒ³ãƒ‰ã«å¿œã˜ã¦åˆ†å²
            if (isAICommand) {
                addLogAI(`ğŸš€ ${getCommandName(command)} ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...`);
                showStatusAI(`${getCommandName(command)} å®Ÿè¡Œä¸­...`, 'info');
            } else {
                addLog(`ğŸš€ ${getCommandName(command)} ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...`);
                showStatus(`${getCommandName(command)} å®Ÿè¡Œä¸­...`, 'info');
            }
            
            try {
                const formData = new FormData();
                formData.append('command', command);
                if (url) formData.append('url', url);
                if (testGoal) formData.append('goal', testGoal);
                if (pdfFile) formData.append('pdf', pdfFile);
                if (csvFile) formData.append('csv', csvFile);
                
                // å®Ÿè¡Œç’°å¢ƒè¨­å®šã‚’é€ä¿¡
                formData.append('executionEnvironment', executionEnvironment);
                formData.append('domAnalysisSource', domAnalysisSource);
                
                // AIä¿®æ­£è¨­å®šã‚’é€ä¿¡ï¼ˆå¤±æ•—åˆ†æã‚³ãƒãƒ³ãƒ‰ã®å ´åˆï¼‰
                if (command === 'analyzeFailures') {
                    formData.append('enableAIFix', enableAIFix ? 'true' : 'false');
                    
                    // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿è¨­å®šã‚’é€ä¿¡
                    if (manualSelectors) {
                        formData.append('manualSelectors', JSON.stringify(manualSelectors));
                        addLogAI(`ğŸ¯ è¦ç´ æŒ‡å®šè¨­å®šã‚’é€ä¿¡: ${Object.keys(manualSelectors).length}ã‚«ãƒ†ã‚´ãƒª`);
                    }
                }
                
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    if (isAICommand) {
                        addLogAI(`âœ… ${getCommandName(command)} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
                    } else {
                        addLog(`âœ… ${getCommandName(command)} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
                    }
                    
                    if (result.output) {
                        if (isAICommand) {
                            addLogAI(result.output);
                        } else {
                            addLog(result.output);
                        }
                        
                        // runRoutesã‚³ãƒãƒ³ãƒ‰ã®å ´åˆã€ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Full output for parsing:', result.output);
                            parseTestResults(result.output);
                            showStatus(`ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼`, 'success');
                        } else if (command === 'generateTestReport') {
                            // HTMLãƒ¬ãƒãƒ¼ãƒˆã®è‡ªå‹•é–‹ãå‡¦ç†
                            if (result.htmlReportUrl) {
                                showStatus(`ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†ï¼HTMLãƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã„ã¦ã„ã¾ã™...`, 'success');
                                setTimeout(() => {
                                    window.open(result.htmlReportUrl, '_blank');
                                }, 500);
                            } else {
                                showStatus(`${getCommandName(command)} å®Œäº†`, 'success');
                            }
                        } else if (command === 'analyzeFailures') {
                            // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ã§ã‚‚ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æ
                            parseTestResultsAI(result.output);
                            showStatusAI(`å¤±æ•—ãƒ†ã‚¹ãƒˆåˆ†æãƒ»ä¿®æ­£ å®Œäº†`, 'success');
                        } else if (command === 'discoverNewStories') {
                            showStatusAI(`æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ å®Œäº†`, 'success');
                        } else {
                            if (isAICommand) {
                                showStatusAI(`${getCommandName(command)} å®Œäº†`, 'success');
                            } else {
                                showStatus(`${getCommandName(command)} å®Œäº†`, 'success');
                            }
                        }
                    } else {
                        if (isAICommand) {
                            showStatusAI(`${getCommandName(command)} å®Œäº†`, 'success');
                        } else {
                            showStatus(`${getCommandName(command)} å®Œäº†`, 'success');
                        }
                    }
                } else {
                    if (isAICommand) {
                        addLogAI(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    } else {
                        addLog(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    }
                    
                    if (result.output) {
                        if (isAICommand) {
                            addLogAI(result.output);
                        } else {
                            addLog(result.output);
                        }
                        
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚runRoutesã®å ´åˆã¯çµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Error output for parsing:', result.output);
                            parseTestResults(result.output);
                            showStatus(`ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ï¼ˆä¸€éƒ¨ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰`, 'warning');
                        } else if (command === 'analyzeFailures') {
                            // ã‚¨ãƒ©ãƒ¼ã§ã‚‚è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ã§ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æã‚’è©¦è¡Œ
                            parseTestResultsAI(result.output);
                            showStatusAI(`å¤±æ•—ãƒ†ã‚¹ãƒˆåˆ†æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                        } else {
                            if (isAICommand) {
                                showStatusAI(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                            } else {
                                showStatus(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                            }
                        }
                    } else {
                        if (isAICommand) {
                            showStatusAI(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                        } else {
                            showStatus(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                        }
                    }
                }
            } catch (error) {
                if (isAICommand) {
                    addLogAI(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    showStatusAI(`é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'error');
                } else {
                    addLog(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                    showStatus(`é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'error');
                }
            }
        }
        
        // ã‚³ãƒãƒ³ãƒ‰åå–å¾—
        function getCommandName(command) {
            const names = {
                'generateTestPoints': 'ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ',
                'generateTestCases': 'ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹å¤‰æ›',
                'generateSmartRoutes': 'Playwrightç”¨ã«å¤‰æ›',
                'runRoutes': 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ',
                'generateTestReport': 'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ',
                'analyzeFailures': 'å¤±æ•—ãƒ†ã‚¹ãƒˆåˆ†æãƒ»ä¿®æ­£',
                'discoverNewStories': 'æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹'
            };
            return names[command] || command;
        }
        
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼IDè¡¨ç¤º
        async function showUserStoryId() {
            try {
                const response = await fetch('/api/config/user-story');
                const result = await response.json();
                
                if (result.success && result.userStory && result.userStory.currentId) {
                    document.getElementById('currentUserStoryId').textContent = `US-${result.userStory.currentId}`;
                    document.getElementById('userStoryId').style.display = 'block';
                    console.log(`ğŸ”— ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ID US-${result.userStory.currentId} ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`);
                } else {
                    // IDãŒæœªæ¡ç•ªã®å ´åˆã¯éè¡¨ç¤º
                    document.getElementById('userStoryId').style.display = 'none';
                }
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼IDå–å¾—ã‚¨ãƒ©ãƒ¼:', error);
                document.getElementById('userStoryId').style.display = 'none';
            }
        }

        // ãƒ†ã‚¹ãƒˆå±¥æ­´ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ï¼ˆç´¯ç©ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒªã‚»ãƒƒãƒˆï¼‰
        async function resetTestHistory() {
            if (!confirm('éå»ã®ãƒ†ã‚¹ãƒˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\n\nâœ¨ ä»¥ä¸‹ã®æƒ…å ±ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ï¼š\n' +
                       'â€¢ ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ID (æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚¯ãƒ«é–‹å§‹)\n' +
                       'â€¢ ç´¯ç©ã‚«ãƒãƒ¬ãƒƒã‚¸æƒ…å ±\n' +
                       'â€¢ éå»ã®ãƒ†ã‚¹ãƒˆçµæœå±¥æ­´\n\n' +
                       'æ¬¡å›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚¯ãƒ«ã¨ã—ã¦é–‹å§‹ã•ã‚Œã¾ã™ã€‚')) {
                return;
            }
            
            try {
                const response = await fetch('/api/reset-test-history', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // UIã‚’æ›´æ–°
                    document.getElementById('currentUserStoryId').textContent = '-';
                    document.getElementById('userStoryId').style.display = 'none';
                    
                    // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                    alert(`âœ… ãƒ†ã‚¹ãƒˆå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸã€‚\n\nğŸ“Š å‰Šé™¤ã•ã‚ŒãŸé …ç›®ï¼š\n` +
                          `â€¢ ãƒ†ã‚¹ãƒˆçµæœãƒ•ã‚¡ã‚¤ãƒ«: ${result.deletedResults || 0}ä»¶\n` +
                          `â€¢ ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: ${result.deletedRoutes || 0}ä»¶\n` +
                          `â€¢ ãƒ¬ãƒãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«: ${result.deletedReports || 0}ä»¶\n\n` +
                          'æ¬¡å›ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚ã«æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚µã‚¤ã‚¯ãƒ«ã¨ã—ã¦é–‹å§‹ã•ã‚Œã¾ã™ã€‚');
                    console.log('ğŸ”„ ãƒ†ã‚¹ãƒˆå±¥æ­´ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ:', result);
                } else {
                    alert(`âŒ ãƒªã‚»ãƒƒãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ: ${result.error}`);
                    console.error('ãƒªã‚»ãƒƒãƒˆã‚¨ãƒ©ãƒ¼:', result.error);
                }
            } catch (error) {
                alert(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                console.error('ãƒ†ã‚¹ãƒˆå±¥æ­´ãƒªã‚»ãƒƒãƒˆé€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
            }
        }

        // ä¸€æ‹¬å®Ÿè¡Œãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
        async function executeBulkWorkflow() {
            const url = document.getElementById('testUrl').value;
            const testGoal = document.getElementById('testGoal').value;
            
            // åŸºæœ¬çš„ãªå…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!url || !url.trim()) {
                alert('âš ï¸ ãƒ†ã‚¹ãƒˆå¯¾è±¡URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!testGoal || !testGoal.trim()) {
                alert('âš ï¸ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°
            if (!confirm('ğŸš€ ä»¥ä¸‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’è‡ªå‹•å®Ÿè¡Œã—ã¾ã™ï¼š\n\n' +
                '1. ğŸ“‹ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ\n' +
                '2. ğŸ­ Playwrightç”¨ã«å¤‰æ›\n' +
                '3. â–¶ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ\n' +
                '4. ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ\n' +
                '5. ğŸ”§ å¤±æ•—åˆ†æï¼ˆå¤±æ•—ãŒã‚ã‚‹å ´åˆï¼‰\n' +
                '6. ğŸš€ å†ãƒˆãƒ©ã‚¤ï¼ˆä¿®æ­£ãƒ«ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆï¼‰\n' +
                '7. ğŸ” æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹\n\n' +
                'å®Ÿè¡Œã—ã¾ã™ã‹ï¼Ÿï¼ˆå‡¦ç†ã«æ•°åˆ†ã‹ã‹ã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ï¼‰')) {
                return;
            }
            
            // ä¸€æ‹¬å®Ÿè¡ŒUIè¡¨ç¤º
            showBulkStatus();
            
            // å„ã‚¿ãƒ–ã®ãƒ­ã‚°ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
            clearAllLogs();
            
            try {
                let hasFailures = false;
                let fixedRouteId = null;
                
                // 1. ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ
                updateBulkProgress('step-testpoints', 'active', 'ğŸ“‹ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’ç”Ÿæˆä¸­...');
                await executeCommand('generateTestPoints');
                await delay(1000);
                updateBulkProgress('step-testpoints', 'completed', 'âœ… ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆå®Œäº†');
                
                // 2. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆ
                updateBulkProgress('step-testcases', 'active', 'ğŸ§  ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’ç”Ÿæˆä¸­...');
                await executeCommand('generateTestCases');
                await delay(1000);
                updateBulkProgress('step-testcases', 'completed', 'âœ… ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ç”Ÿæˆå®Œäº†');
                
                // 3. Playwrightç”¨ã«å¤‰æ›
                updateBulkProgress('step-routes', 'active', 'ğŸ­ Playwrightç”¨ã«å¤‰æ›ä¸­...');
                await executeCommand('generateSmartRoutes');
                await delay(1000);
                updateBulkProgress('step-routes', 'completed', 'âœ… Playwrightç”¨ã«å¤‰æ›å®Œäº†');
                
                // 4. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                updateBulkProgress('step-run', 'active', 'â–¶ï¸ ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œä¸­...');
                await executeCommand('runRoutes');
                await delay(1000);
                updateBulkProgress('step-run', 'completed', 'âœ… ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå®Œäº†');
                
                // å¤±æ•—æ•°ã‚’ãƒã‚§ãƒƒã‚¯
                const failureCountElement = document.getElementById('failureCount');
                if (failureCountElement && failureCountElement.textContent !== '-' && parseInt(failureCountElement.textContent) > 0) {
                    hasFailures = true;
                }
                
                // 5. ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                updateBulkProgress('step-report', 'active', 'ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆä¸­...');
                const reportResult = await executeCommandWithResult('generateTestReport');
                await delay(1000);
                updateBulkProgress('step-report', 'completed', 'âœ… ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº†');
                
                // HTMLãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Œã°ä¿å­˜
                let htmlReportUrl = null;
                if (reportResult && reportResult.htmlReportUrl) {
                    htmlReportUrl = reportResult.htmlReportUrl;
                }
                
                // 6. å¤±æ•—åˆ†æï¼ˆå¤±æ•—ãŒã‚ã‚‹å ´åˆï¼‰
                if (hasFailures) {
                    updateBulkProgress('step-analyze', 'active', 'ğŸ”§ å¤±æ•—ãƒ†ã‚¹ãƒˆã‚’åˆ†æä¸­...');
                    
                    // AIä¿®æ­£è¨­å®šã‚’åæ˜ ã—ã¦å¤±æ•—åˆ†æã‚’å®Ÿè¡Œ
                    const enableAIFix = document.getElementById('enableAIFix').checked;
                    if (enableAIFix) {
                        addLog('ğŸ¤– AIä¿®æ­£ãƒ¢ãƒ¼ãƒ‰ã§å¤±æ•—åˆ†æã‚’å®Ÿè¡Œä¸­...');
                    } else {
                        addLog('ğŸ”§ ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ä¿®æ­£ãƒ¢ãƒ¼ãƒ‰ã§å¤±æ•—åˆ†æã‚’å®Ÿè¡Œä¸­...');
                    }
                    
                    await executeCommand('analyzeFailures');
                    await delay(2000); // åˆ†æã¯æ™‚é–“ãŒã‹ã‹ã‚‹ãŸã‚å°‘ã—é•·ã‚ã«å¾…æ©Ÿ
                    
                    // ä¿®æ­£ãƒ«ãƒ¼ãƒˆãŒç”Ÿæˆã•ã‚ŒãŸã‹ãƒã‚§ãƒƒã‚¯
                    const response = await fetch('/api/check-fixed-routes');
                    const result = await response.json();
                    if (result.success && result.hasFixedRoutes) {
                        fixedRouteId = result.latestFixedRoute;
                        updateBulkProgress('step-analyze', 'completed', 'âœ… å¤±æ•—åˆ†æå®Œäº†ï¼ˆä¿®æ­£ãƒ«ãƒ¼ãƒˆç”Ÿæˆæ¸ˆã¿ï¼‰');
                    } else {
                        updateBulkProgress('step-analyze', 'completed', 'âœ… å¤±æ•—åˆ†æå®Œäº†');
                    }
                } else {
                    updateBulkProgress('step-analyze', 'completed', 'â­ï¸ å¤±æ•—ãªã—ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—');
                }
                
                // 7. å†ãƒˆãƒ©ã‚¤ï¼ˆä¿®æ­£ãƒ«ãƒ¼ãƒˆãŒã‚ã‚‹å ´åˆï¼‰
                if (fixedRouteId) {
                    updateBulkProgress('step-retry', 'active', 'ğŸš€ ä¿®æ­£ãƒ«ãƒ¼ãƒˆã§å†ãƒˆãƒ©ã‚¤ä¸­...');
                    await runFixedRoute(fixedRouteId);
                    await delay(1000);
                    updateBulkProgress('step-retry', 'completed', 'âœ… å†ãƒˆãƒ©ã‚¤å®Œäº†');
                } else {
                    updateBulkProgress('step-retry', 'completed', 'â­ï¸ ä¿®æ­£ãƒ«ãƒ¼ãƒˆãªã—ã®ãŸã‚ã‚¹ã‚­ãƒƒãƒ—');
                }
                
                // 8. æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹
                updateBulkProgress('step-stories', 'active', 'ğŸ” æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’ç™ºè¦‹ä¸­...');
                await executeCommand('discoverNewStories');
                await delay(1000);
                updateBulkProgress('step-stories', 'completed', 'âœ… æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹å®Œäº†');
                
                // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                updateBulkCurrentAction('ğŸ‰ ã™ã¹ã¦ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒå®Œäº†ã—ã¾ã—ãŸï¼');
                
                setTimeout(() => {
                    // HTMLãƒ¬ãƒãƒ¼ãƒˆãŒã‚ã‚Œã°è‡ªå‹•ã§é–‹ã
                    if (htmlReportUrl) {
                        if (confirm('ğŸ‰ ä¸€æ‹¬å®Ÿè¡ŒãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\nHTMLãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆã‚’è‡ªå‹•ã§é–‹ãã¾ã™ã‹ï¼Ÿ\n\n' +
                                    'å„ã‚¿ãƒ–ã§è©³ç´°ãªçµæœã‚‚ç¢ºèªã§ãã¾ã™ï¼š\n' +
                                    'â€¢ ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: å®Ÿè¡Œçµæœã¨ã‚µãƒãƒªãƒ¼\n' +
                                    'â€¢ ğŸ¤– è‡ªå‹•æ”¹å–„ãƒ»å­¦ç¿’æ©Ÿèƒ½: å¤±æ•—åˆ†æã¨ä¿®æ­£çµæœ\n' +
                                    'â€¢ ğŸ“– æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼: ç™ºè¦‹ã•ã‚ŒãŸæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼')) {
                            window.open(htmlReportUrl, '_blank');
                        }
                    } else {
                        alert('ğŸ‰ ä¸€æ‹¬å®Ÿè¡ŒãŒå®Œäº†ã—ã¾ã—ãŸï¼\n\n' +
                            'å„ã‚¿ãƒ–ã§è©³ç´°ãªçµæœã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š\n' +
                            'â€¢ ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ: å®Ÿè¡Œçµæœã¨ã‚µãƒãƒªãƒ¼\n' +
                            'â€¢ ğŸ¤– è‡ªå‹•æ”¹å–„ãƒ»å­¦ç¿’æ©Ÿèƒ½: å¤±æ•—åˆ†æã¨ä¿®æ­£çµæœ\n' +
                            'â€¢ ğŸ“– æ–°ã—ã„ã‚¹ãƒˆãƒ¼ãƒªãƒ¼: ç™ºè¦‹ã•ã‚ŒãŸæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼');
                    }
                }, 1000);
                
            } catch (error) {
                console.error('ä¸€æ‹¬å®Ÿè¡Œã‚¨ãƒ©ãƒ¼:', error);
                updateBulkCurrentAction(`âŒ ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
                alert(`âŒ ä¸€æ‹¬å®Ÿè¡Œä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:\n${error.message}\n\nå„ã‚¿ãƒ–ã§è©³ç´°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚`);
            }
        }
        
        // çµæœã‚’è¿”ã™ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œé–¢æ•°ï¼ˆä¸€æ‹¬å®Ÿè¡Œç”¨ï¼‰
        async function executeCommandWithResult(command) {
            const url = document.getElementById('testUrl').value;
            const testGoal = document.getElementById('testGoal').value;
            const pdfFile = document.getElementById('pdfFile').files[0];
            const csvFile = document.getElementById('csvFile').files[0];
            
            try {
                const formData = new FormData();
                formData.append('command', command);
                if (url) formData.append('url', url);
                if (testGoal) formData.append('goal', testGoal);
                if (pdfFile) formData.append('pdf', pdfFile);
                if (csvFile) formData.append('csv', csvFile);
                
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                // ãƒ­ã‚°ã«çµæœã‚’å‡ºåŠ›ï¼ˆé€šå¸¸ã®executeCommandã¨åŒã˜å‡¦ç†ï¼‰
                if (result.success) {
                    addLog(`âœ… ${getCommandName(command)} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
                    if (result.output) {
                        addLog(result.output);
                    }
                } else {
                    addLog(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    if (result.output) {
                        addLog(result.output);
                    }
                }
                
                return result;
            } catch (error) {
                addLog(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                return null;
            }
        }

        // ä¸€æ‹¬å®Ÿè¡Œç”¨ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
        function showBulkStatus() {
            document.getElementById('bulkStatus').style.display = 'block';
            // ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—ã‚’åˆæœŸçŠ¶æ…‹ã«ãƒªã‚»ãƒƒãƒˆ
            const steps = ['step-testpoints', 'step-testcases', 'step-routes', 'step-run', 'step-report', 'step-analyze', 'step-retry', 'step-stories'];
            steps.forEach(stepId => {
                const element = document.getElementById(stepId);
                element.className = 'progress-step';
            });
            updateBulkCurrentAction('ğŸš€ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’é–‹å§‹ã—ã¾ã™...');
        }
        
        function updateBulkProgress(stepId, status, message) {
            const element = document.getElementById(stepId);
            element.className = `progress-step ${status}`;
            updateBulkCurrentAction(message);
        }
        
        function updateBulkCurrentAction(message) {
            document.getElementById('bulkCurrentAction').textContent = message;
        }
        
        function clearAllLogs() {
            // å„ã‚¿ãƒ–ã®ãƒ­ã‚°ã‚¨ãƒªã‚¢ã‚’ã‚¯ãƒªã‚¢
            document.getElementById('logArea').textContent = 'å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
            document.getElementById('logAreaAI').textContent = 'å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
            document.getElementById('logAreaNewStories').textContent = 'å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
        }
        
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç”¨ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œé–¢æ•°
        async function executeNewStoryCommand(command) {
            const url = document.getElementById('testUrl').value;
            const testGoal = document.getElementById('testGoal').value;
            const pdfFile = document.getElementById('pdfFile').files[0];
            const csvFile = document.getElementById('csvFile').files[0];
            
            // URLå…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!url && command !== 'runRoutes' && command !== 'generateTestReport') {
                showStatusNewStories('ãƒ†ã‚¹ãƒˆå¯¾è±¡URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠãƒã‚§ãƒƒã‚¯
            if (!testGoal || !testGoal.trim()) {
                showStatusNewStories('ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒå…¥åŠ›ã•ã‚Œã¦ã„ã‚‹å ´åˆã€ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£IDã‚’è¡¨ç¤º
            if (testGoal && testGoal.trim()) {
                showUserStoryId();
            }
            
            addLogNewStories(`ğŸš€ ${getCommandName(command)} ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...`);
            showStatusNewStories(`${getCommandName(command)} å®Ÿè¡Œä¸­...`, 'info');
            
            try {
                const formData = new FormData();
                formData.append('command', command);
                if (url) formData.append('url', url);
                if (testGoal) formData.append('goal', testGoal);
                if (pdfFile) formData.append('pdf', pdfFile);
                if (csvFile) formData.append('csv', csvFile);
                
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLogNewStories(`âœ… ${getCommandName(command)} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
                    
                    if (result.output) {
                        addLogNewStories(result.output);
                        
                        // runRoutesã‚³ãƒãƒ³ãƒ‰ã®å ´åˆã€ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Full output for parsing (New Stories):', result.output);
                            parseTestResultsNewStories(result.output);
                            showStatusNewStories(`æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼`, 'success');
                        } else {
                            showStatusNewStories(`${getCommandName(command)} å®Œäº†`, 'success');
                        }
                    } else {
                        showStatusNewStories(`${getCommandName(command)} å®Œäº†`, 'success');
                    }
                } else {
                    addLogNewStories(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    
                    if (result.output) {
                        addLogNewStories(result.output);
                        
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚runRoutesã®å ´åˆã¯çµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Error output for parsing (New Stories):', result.output);
                            parseTestResultsNewStories(result.output);
                            showStatusNewStories(`æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ï¼ˆä¸€éƒ¨ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰`, 'warning');
                        } else {
                            showStatusNewStories(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                        }
                    } else {
                        showStatusNewStories(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                    }
                }
            } catch (error) {
                addLogNewStories(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatusNewStories(`é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'error');
            }
        }

        // ãƒ†ã‚¹ãƒˆçµæœè§£æé–¢æ•°
        function parseTestResults(output) {
            try {
                console.log('ğŸ› ï¸ [Debug] Parsing test results...');
                const lines = output.split('\n');
                let testId = '-';
                let totalSteps = '-';
                let successCount = '-';
                let failureCount = '-';
                const failedTests = [];
                let resultFilePath = '';
                
                let inFailedSection = false;
                
                console.log('ğŸ› ï¸ [Debug] Total lines to parse:', lines.length);
                
                for (const line of lines) {
                    // ãƒ†ã‚¹ãƒˆIDã®æŠ½å‡º
                    const testIdMatch = line.match(/ğŸ”· ãƒ†ã‚¹ãƒˆID:\s*(.+)/);
                    if (testIdMatch) {
                        testId = testIdMatch[1].trim();
                    }
                    
                    // ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®æŠ½å‡º
                    const totalStepsMatch = line.match(/ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:\s*(\d+)/);
                    if (totalStepsMatch) {
                        totalSteps = totalStepsMatch[1];
                    }
                    
                    // æˆåŠŸæ•°ã®æŠ½å‡º
                    const successMatch = line.match(/ğŸ”· æˆåŠŸæ•°:\s*(\d+)/);
                    if (successMatch) {
                        successCount = successMatch[1];
                    }
                    
                    // å¤±æ•—æ•°ã®æŠ½å‡º
                    const failureMatch = line.match(/ğŸ”· å¤±æ•—æ•°:\s*(\d+)/);
                    if (failureMatch) {
                        failureCount = failureMatch[1];
                    }
                    
                    // çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŠ½å‡º
                    const resultFileMatch = line.match(/ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ:\s*(.+\.json)/);
                    if (resultFileMatch) {
                        resultFilePath = resultFileMatch[1].trim();
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
                    if (line.includes('âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:')) {
                        inFailedSection = true;
                        continue;
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æŠ½å‡ºï¼ˆã‚ˆã‚Šæ­£ç¢ºãªè§£æï¼‰
                    if (inFailedSection) {
                        // "  - " ã§å§‹ã¾ã‚‹è¡Œã‚’æŠ½å‡º
                        const failedTestMatch = line.match(/^\s*-\s*(.+)/);
                        if (failedTestMatch) {
                            const failedTest = cleanErrorMessage(failedTestMatch[1].trim());
                            if (failedTest.trim()) {
                                failedTests.push(failedTest);
                            }
                        }
                        
                        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†åˆ¤å®šï¼ˆç©ºè¡Œã¾ãŸã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ï¼‰
                        if (line.trim() === '' || line.includes('ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ')) {
                            inFailedSection = false;
                        }
                    }
                }
                
                // ã‚µãƒãƒªãƒ¼è¡¨ç¤º
                console.log('ğŸ› ï¸ [Debug] Extracted data:', {testId, totalSteps, successCount, failureCount, failedTestsCount: failedTests.length, resultFilePath});
                displayTestSummary(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath);
                
            } catch (error) {
                console.error('ãƒ†ã‚¹ãƒˆçµæœè§£æã‚¨ãƒ©ãƒ¼:', error);
                addLog(`âš ï¸ ãƒ†ã‚¹ãƒˆçµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´ç†ã™ã‚‹é–¢æ•°
        function cleanErrorMessage(message) {
            console.log('ğŸ› ï¸ [Debug] Original message:', message); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            // æ”¹è¡Œã‚’å«ã‚€é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´ç†
            let cleanedMessage = message;
            
            // ã¾ãšã€ã‚³ãƒ­ãƒ³ã§ãƒ†ã‚¹ãƒˆåã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†é›¢
            const colonIndex = cleanedMessage.indexOf(':');
            let testName = '';
            let errorPart = cleanedMessage;
            
            if (colonIndex > 0 && colonIndex < 100) {
                testName = cleanedMessage.substring(0, colonIndex).trim();
                errorPart = cleanedMessage.substring(colonIndex + 1).trim();
            }
            
            // ã‚¨ãƒ©ãƒ¼éƒ¨åˆ†ã‚’ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
            // é•·ã„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\/Users\/[^\s]*\/autoplaywright\/[^\s]*/g, '');
            
            // PlaywrightRunner.executeStep ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*at\s+PlaywrightRunner\.executeStep[\s\S]*$/g, '');
            
            // Call log ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/Call\s+log:\s*[\s\S]*$/g, '');
            
            // ANSI ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\[\d+m/g, '');
            
            // ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã® at xxx éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*at\s+[^\n]*/g, '');
            
            // { name: 'TimeoutError' } ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*\{\s*name:\s*['"][^'"]*['"]\s*\}/g, '');
            
            // è¤‡æ•°ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚„æ”¹è¡Œã‚’å˜ä¸€ã‚¹ãƒšãƒ¼ã‚¹ã«
            errorPart = errorPart.replace(/\s+/g, ' ').trim();
            
            // ä¸»è¦ãªã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«åŸºã¥ã„ã¦ç°¡æ½”ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›
            const errorPatterns = [
                {
                    pattern: /page\.waitForSelector:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ è¦ç´ å¾…æ©Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.click:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ ã‚¯ãƒªãƒƒã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.fill:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ å…¥åŠ›ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.fill:\s*Error:\s*Element\s+is\s+not\s+an\s+<input>/i,
                    replacement: 'ğŸš« å…¥åŠ›è¦ç´ ã§ã¯ã‚ã‚Šã¾ã›ã‚“'
                },
                {
                    pattern: /page\.waitForURL:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ URLé·ç§»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /element\s+is\s+not\s+visible/i,
                    replacement: 'ğŸ‘ï¸ è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“'
                },
                {
                    pattern: /element\s+is\s+disabled/i,
                    replacement: 'ğŸš« è¦ç´ ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™'
                },
                {
                    pattern: /waiting\s+for\s+element\s+to\s+be\s+visible,\s+enabled\s+and\s+editable/i,
                    replacement: 'â³ è¦ç´ ãŒç·¨é›†å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿä¸­'
                }
            ];
            
            // ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ç½®æ›
            let finalError = errorPart;
            for (const {pattern, replacement} of errorPatterns) {
                if (pattern.test(errorPart)) {
                    finalError = errorPart.replace(pattern, replacement);
                    break;
                }
            }
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã—ãªã„å ´åˆã®ä¸€èˆ¬çš„ãªã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
            if (finalError === errorPart) {
                if (finalError.includes('Timeout') && finalError.includes('exceeded')) {
                    finalError = 'â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼';
                } else if (finalError.includes('Error:')) {
                    const errorIndex = finalError.indexOf('Error:');
                    finalError = 'âŒ ' + finalError.substring(errorIndex + 6).trim();
                }
            }
            
            // æœ€çµ‚çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰
            let result = testName ? `${testName}: ${finalError}` : finalError;
            
            // é•·ã™ãã‚‹å ´åˆã¯çŸ­ç¸®
            if (result.length > 150) {
                result = result.substring(0, 147) + '...';
            }
            
            console.log('ğŸ› ï¸ [Debug] Cleaned message:', result); // ãƒ‡ãƒãƒƒã‚°ç”¨
            return result;
        }

        // ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼è¡¨ç¤ºé–¢æ•°
        function displayTestSummary(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath) {
            // å€¤ã‚’è¨­å®š
            document.getElementById('testId').textContent = testId;
            document.getElementById('totalSteps').textContent = totalSteps;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failureCount').textContent = failureCount;
            
            // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¡¨ç¤º
            const failedTestsSection = document.getElementById('failedTests');
            const failedTestsList = document.getElementById('failedTestsList');
            
            if (failedTests.length > 0) {
                failedTestsList.innerHTML = '';
                failedTests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = test;
                    failedTestsList.appendChild(li);
                });
                failedTestsSection.style.display = 'block';
            } else {
                failedTestsSection.style.display = 'none';
            }
            
            // æ—¢å­˜ã®çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤
            const existingLink = document.getElementById('resultFileLink');
            if (existingLink) {
                existingLink.remove();
            }
            
            // çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
            if (resultFilePath) {
                const filename = resultFilePath.split('/').pop();
                const resultFileContainer = document.createElement('div');
                resultFileContainer.id = 'resultFileLink';
                resultFileContainer.style.marginTop = '15px';
                resultFileContainer.style.padding = '15px';
                resultFileContainer.style.background = 'linear-gradient(135deg, #f8f9fa, #e9ecef)';
                resultFileContainer.style.border = '2px solid #007bff';
                resultFileContainer.style.borderRadius = '10px';
                resultFileContainer.style.textAlign = 'center';
                
                const linkTitle = document.createElement('h4');
                linkTitle.textContent = 'ğŸ“„ ãƒ†ã‚¹ãƒˆçµæœãƒ•ã‚¡ã‚¤ãƒ«';
                linkTitle.style.margin = '0 0 10px 0';
                linkTitle.style.color = '#0056b3';
                linkTitle.style.fontSize = '1rem';
                
                const resultFileLink = document.createElement('a');
                resultFileLink.href = `/api/results/${filename}`;
                resultFileLink.textContent = `ğŸ“ ${filename}`;
                resultFileLink.style.display = 'inline-block';
                resultFileLink.style.marginTop = '5px';
                resultFileLink.style.textDecoration = 'none';
                resultFileLink.style.color = 'white';
                resultFileLink.style.padding = '10px 20px';
                resultFileLink.style.background = 'linear-gradient(135deg, #007bff, #0056b3)';
                resultFileLink.style.borderRadius = '8px';
                resultFileLink.style.transition = 'all 0.3s ease';
                resultFileLink.style.fontWeight = '600';
                
                resultFileLink.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(0, 123, 255, 0.3)';
                });
                
                resultFileLink.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                });
                
                resultFileContainer.appendChild(linkTitle);
                resultFileContainer.appendChild(resultFileLink);
                document.getElementById('testSummary').appendChild(resultFileContainer);
                
                addLog(`ğŸ“ çµæœãƒ•ã‚¡ã‚¤ãƒ«: ${filename} ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`);
            }
            
            // ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('testSummary').style.display = 'block';
            
            addLog(`ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ`);
        }
        
        // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ç”¨ã®ãƒ†ã‚¹ãƒˆçµæœè§£æé–¢æ•°
        function parseTestResultsAI(output) {
            try {
                console.log('ğŸ› ï¸ [Debug] Parsing AI test results...');
                const lines = output.split('\n');
                let testId = '-';
                let totalSteps = '-';
                let successCount = '-';
                let failureCount = '-';
                const failedTests = [];
                let resultFilePath = '';
                
                let inFailedSection = false;
                
                for (const line of lines) {
                    // ãƒ†ã‚¹ãƒˆIDã®æŠ½å‡º
                    const testIdMatch = line.match(/ğŸ”· ãƒ†ã‚¹ãƒˆID:\s*(.+)/);
                    if (testIdMatch) {
                        testId = testIdMatch[1].trim();
                    }
                    
                    // ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®æŠ½å‡º
                    const totalStepsMatch = line.match(/ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:\s*(\d+)/);
                    if (totalStepsMatch) {
                        totalSteps = totalStepsMatch[1];
                    }
                    
                    // æˆåŠŸæ•°ã®æŠ½å‡º
                    const successMatch = line.match(/ğŸ”· æˆåŠŸæ•°:\s*(\d+)/);
                    if (successMatch) {
                        successCount = successMatch[1];
                    }
                    
                    // å¤±æ•—æ•°ã®æŠ½å‡º
                    const failureMatch = line.match(/ğŸ”· å¤±æ•—æ•°:\s*(\d+)/);
                    if (failureMatch) {
                        failureCount = failureMatch[1];
                    }
                    
                    // çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŠ½å‡º
                    const resultFileMatch = line.match(/ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ:\s*(.+\.json)/);
                    if (resultFileMatch) {
                        resultFilePath = resultFileMatch[1].trim();
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
                    if (line.includes('âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:')) {
                        inFailedSection = true;
                        continue;
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æŠ½å‡º
                    if (inFailedSection) {
                        const failedTestMatch = line.match(/^\s*-\s*(.+)/);
                        if (failedTestMatch) {
                            const failedTest = cleanErrorMessage(failedTestMatch[1].trim());
                            if (failedTest.trim()) {
                                failedTests.push(failedTest);
                            }
                        }
                        
                        if (line.trim() === '' || line.includes('ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ')) {
                            inFailedSection = false;
                        }
                    }
                }
                
                // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ã®ã‚µãƒãƒªãƒ¼è¡¨ç¤º
                displayTestSummaryAI(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath);
                
            } catch (error) {
                console.error('è‡ªå‹•æ”¹å–„ãƒ†ã‚¹ãƒˆçµæœè§£æã‚¨ãƒ©ãƒ¼:', error);
                addLogAI(`âš ï¸ ãƒ†ã‚¹ãƒˆçµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }
        
        // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ç”¨ã®ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼è¡¨ç¤ºé–¢æ•°
        function displayTestSummaryAI(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath) {
            // å€¤ã‚’è¨­å®š
            document.getElementById('testIdAI').textContent = testId;
            document.getElementById('totalStepsAI').textContent = totalSteps;
            document.getElementById('successCountAI').textContent = successCount;
            document.getElementById('failureCountAI').textContent = failureCount;
            
            // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¡¨ç¤º
            const failedTestsSection = document.getElementById('failedTestsAI');
            const failedTestsList = document.getElementById('failedTestsListAI');
            
            if (failedTests.length > 0) {
                failedTestsList.innerHTML = '';
                failedTests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = test;
                    failedTestsList.appendChild(li);
                });
                failedTestsSection.style.display = 'block';
            } else {
                failedTestsSection.style.display = 'none';
            }
            
            // ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('testSummaryAI').style.display = 'block';
            
            addLogAI(`ğŸ“Š è‡ªå‹•æ”¹å–„ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ`);
        }
        
        // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ç”¨ã®ãƒ†ã‚¹ãƒˆçµæœè§£æé–¢æ•°
        function parseTestResultsNewStories(output) {
            try {
                console.log('ğŸ› ï¸ [Debug] Parsing New Stories test results...');
                const lines = output.split('\n');
                let testId = '-';
                let totalSteps = '-';
                let successCount = '-';
                let failureCount = '-';
                const failedTests = [];
                let resultFilePath = '';
                
                let inFailedSection = false;
                
                for (const line of lines) {
                    // ãƒ†ã‚¹ãƒˆIDã®æŠ½å‡º
                    const testIdMatch = line.match(/ğŸ”· ãƒ†ã‚¹ãƒˆID:\s*(.+)/);
                    if (testIdMatch) {
                        testId = testIdMatch[1].trim();
                    }
                    
                    // ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®æŠ½å‡º
                    const totalStepsMatch = line.match(/ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:\s*(\d+)/);
                    if (totalStepsMatch) {
                        totalSteps = totalStepsMatch[1];
                    }
                    
                    // æˆåŠŸæ•°ã®æŠ½å‡º
                    const successMatch = line.match(/ğŸ”· æˆåŠŸæ•°:\s*(\d+)/);
                    if (successMatch) {
                        successCount = successMatch[1];
                    }
                    
                    // å¤±æ•—æ•°ã®æŠ½å‡º
                    const failureMatch = line.match(/ğŸ”· å¤±æ•—æ•°:\s*(\d+)/);
                    if (failureMatch) {
                        failureCount = failureMatch[1];
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®é–‹å§‹
                    if (line.includes('âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:')) {
                        inFailedSection = true;
                        continue;
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æŠ½å‡º
                    if (inFailedSection && line.includes('- ')) {
                        const failedTest = line.replace('STDOUT:', '').replace(/^\s*[-]\s*/, '').trim();
                        if (failedTest) {
                            failedTests.push(failedTest);
                        }
                    }
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŠ½å‡º
                    const filePathMatch = line.match(/ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ:\s*(.+)/);
                    if (filePathMatch) {
                        resultFilePath = filePathMatch[1].trim();
                        inFailedSection = false; // ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜æ™‚ç‚¹ã§å¤±æ•—ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†
                    }
                }
                
                // çµæœã‚’è¡¨ç¤º
                displayTestSummaryNewStories(testId, totalSteps, successCount, failureCount, failedTests);
                
                if (resultFilePath) {
                    addLogNewStories(`ğŸ“ ãƒ†ã‚¹ãƒˆçµæœãƒ•ã‚¡ã‚¤ãƒ«: ${resultFilePath}`);
                }
                
                console.log('ğŸ› ï¸ [Debug] Parsed New Stories results:', {
                    testId, totalSteps, successCount, failureCount, failedTests
                });
            } catch (error) {
                console.error('ğŸ› ï¸ [Debug] Error parsing New Stories test results:', error);
                addLogNewStories(`âŒ ãƒ†ã‚¹ãƒˆçµæœã®è§£æã§ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}`);
            }
        }
        
        // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ç”¨ã®ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼è¡¨ç¤ºé–¢æ•°
        function displayTestSummaryNewStories(testId, totalSteps, successCount, failureCount, failedTests) {
            document.getElementById('testIdNewStories').textContent = testId;
            document.getElementById('totalStepsNewStories').textContent = totalSteps;
            document.getElementById('successCountNewStories').textContent = successCount;
            document.getElementById('failureCountNewStories').textContent = failureCount;
            
            // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¡¨ç¤º
            const failedTestsList = document.getElementById('failedTestsListNewStories');
            const failedTestsContainer = document.getElementById('failedTestsNewStories');
            
            if (failedTests.length > 0) {
                failedTestsList.innerHTML = '';
                failedTests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = test;
                    failedTestsList.appendChild(li);
                });
                failedTestsContainer.style.display = 'block';
            } else {
                failedTestsContainer.style.display = 'none';
            }
            
            // ã‚µãƒãƒªãƒ¼ã‚’è¡¨ç¤º
            document.getElementById('testSummaryNewStories').style.display = 'block';
            addLogNewStories(`ğŸ“Š æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ`);
        }

        // AIè¨­å®šé–¢æ•°
        function updateTemperatureDisplay() {
            const temperature = document.getElementById('aiTemperature').value;
            document.getElementById('temperatureValue').textContent = temperature;
        }
        
        function updateTopPDisplay() {
            const topP = document.getElementById('aiTopP').value;
            document.getElementById('topPValue').textContent = topP;
        }
        
        function loadAIConfig(config) {
            if (config.openai) {
                document.getElementById('aiModel').value = config.openai.model || 'gpt-4o-mini';
                document.getElementById('aiTemperature').value = config.openai.temperature || 0.5;
                document.getElementById('aiMaxTokens').value = config.openai.max_tokens || 4000;
                document.getElementById('aiTopP').value = config.openai.top_p || 0.9;
                updateTemperatureDisplay();
                updateTopPDisplay();
            }
        }
        
        async function saveAIConfig() {
            const aiConfig = {
                model: document.getElementById('aiModel').value,
                temperature: parseFloat(document.getElementById('aiTemperature').value),
                max_tokens: parseInt(document.getElementById('aiMaxTokens').value),
                top_p: parseFloat(document.getElementById('aiTopP').value)
            };
            
            try {
                const response = await fetch('/api/config/ai', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(aiConfig)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('ğŸ’¾ AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    showStatus('AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                } else {
                    addLog(`âŒ AIè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    showStatus('AIè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                addLog(`âŒ AIè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatus('AIè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        function resetAIConfig() {
            document.getElementById('aiModel').value = 'gpt-4o-mini';
            document.getElementById('aiTemperature').value = 0.5;
            document.getElementById('aiMaxTokens').value = 4000;
            document.getElementById('aiTopP').value = 0.9;
            updateTemperatureDisplay();
            updateTopPDisplay();
            addLog('ğŸ”„ AIè¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ');
            showStatus('AIè¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ', 'info');
        }



        // æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showManualGuide() {
            document.getElementById('manualGuideModal').style.display = 'block';
            addLog('ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä½œæˆã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
        }
        
        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('manualGuideModal').style.display = 'none';
                document.getElementById('fixedRouteModal').style.display = 'none';
                document.getElementById('discoveredStoriesModal').style.display = 'none';
                addLog('ğŸ“‹ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã¾ã—ãŸ');
            }
        }

        // ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        async function showDiscoveredStoriesModal() {
            document.getElementById('discoveredStoriesModal').style.display = 'block';
            addLogNewStories('ğŸ“– ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼é¸æŠç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
            
            // ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
            await loadDiscoveredStories();
        }

        // ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§èª­ã¿è¾¼ã¿
        async function loadDiscoveredStories() {
            try {
                const response = await fetch('/api/list-files?pattern=discovered_stories_*.json');
                const result = await response.json();
                
                const storiesListEl = document.getElementById('discoveredStoriesList');
                
                if (result.success && result.files && result.files.length > 0) {
                    let html = '<div class="file-list">';
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ—¥ä»˜é †ã«ã‚½ãƒ¼ãƒˆï¼ˆæ–°ã—ã„é †ï¼‰
                    const sortedFiles = result.files.sort((a, b) => b.localeCompare(a));
                    
                    for (const file of sortedFiles) {
                        // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æ—¥æ™‚ã‚’æŠ½å‡º
                        const dateMatch = file.match(/discovered_stories_(.+)\.json$/);
                        const dateStr = dateMatch ? dateMatch[1].replace(/T/g, ' ').replace(/-/g, '/').replace('Z', '') : 'Unknown';
                        
                        html += `
                            <div class="file-item">
                                <div class="file-info">
                                    <div class="file-name">ğŸ“ ${file}</div>
                                    <div class="file-date">ğŸ“… ä½œæˆæ—¥æ™‚: ${dateStr}</div>
                                </div>
                                <button class="btn btn-small btn-info" onclick="loadDiscoveredStoriesFromFile('${file}')">
                                    ğŸ“‹ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§è¡¨ç¤º
                                </button>
                            </div>
                        `;
                    }
                    
                    html += '</div>';
                    storiesListEl.innerHTML = html;
                } else {
                    storiesListEl.innerHTML = '<p>âŒ ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚<br>ã¾ãšã€Œæ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ç™ºè¦‹ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>';
                }
            } catch (error) {
                console.error('ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                const storiesListEl = document.getElementById('discoveredStoriesList');
                storiesListEl.innerHTML = '<p>âŒ ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ</p>';
            }
        }

        // ç™ºè¦‹æ¸ˆã¿ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
        async function loadDiscoveredStoriesFromFile(fileName) {
            try {
                const response = await fetch(`/api/get-file?path=${encodeURIComponent(fileName)}`);
                const result = await response.json();
                
                if (result.success && result.content) {
                    const storiesData = JSON.parse(result.content);
                    displayDiscoveredStories(storiesData.discoveredStories || []);
                } else {
                    addLogNewStories(`âŒ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                }
            } catch (error) {
                console.error('ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', error);
                addLogNewStories(`âŒ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // ç™ºè¦‹ã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§ã‚’è¡¨ç¤º
        function displayDiscoveredStories(stories) {
            const storiesListEl = document.getElementById('discoveredStoriesList');
            
            if (stories.length === 0) {
                storiesListEl.innerHTML = '<p>âŒ ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p>';
                return;
            }
            
            let html = '<div class="stories-list"><h4>ğŸ“– ç™ºè¦‹ã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ä¸€è¦§</h4>';
            
            stories.forEach((story, index) => {
                const priorityColor = story.priority === 'é«˜' ? 'high' : story.priority === 'ä¸­' ? 'medium' : 'low';
                
                html += `
                    <div class="story-item">
                        <div class="story-info">
                            <div class="story-title">ğŸ“‹ ${story.story}</div>
                            <div class="story-priority priority-${priorityColor}">ğŸ¯ å„ªå…ˆåº¦: ${story.priority}</div>
                            ${story.recommendedUrl ? `<div class="story-url">ğŸ”— æ¨å¥¨URL: ${story.recommendedUrl}</div>` : ''}
                        </div>
                        <button class="btn btn-small btn-success" onclick="selectDiscoveredStory('${story.story.replace(/'/g, "\\'")}', '${story.priority}', '${story.recommendedUrl || ''}')">
                            âœ… ã“ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠ
                        </button>
                    </div>
                `;
            });
            
            html += '</div>';
            storiesListEl.innerHTML = html;
        }

        // ç™ºè¦‹ã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠ
        function selectDiscoveredStory(story, priority, recommendedUrl) {
            // åŸºæœ¬è¨­å®šã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼æ¬„ã«è¨­å®š
            document.getElementById('testGoal').value = story;
            
            // æ¨å¥¨URLãŒã‚ã‚‹å ´åˆã¯ã€URLãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚‚æ›´æ–°
            if (recommendedUrl && recommendedUrl !== 'undefined' && recommendedUrl.trim()) {
                document.getElementById('testUrl').value = recommendedUrl;
                addLogNewStories(`ğŸ”— æ¨å¥¨URLã‚’è¨­å®šã—ã¾ã—ãŸ: ${recommendedUrl}`);
            }
            
            // é¸æŠã•ã‚ŒãŸã‚¹ãƒˆãƒ¼ãƒªãƒ¼æƒ…å ±ã‚’è¡¨ç¤º
            document.getElementById('selectedStoryText').textContent = story;
            document.getElementById('selectedStoryPriority').textContent = priority;
            document.getElementById('selectedStoryUrl').textContent = recommendedUrl || 'æŒ‡å®šãªã—';
            document.getElementById('selectedStoryDisplay').style.display = 'block';
            
            // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
            document.getElementById('discoveredStoriesModal').style.display = 'none';
            
            // æ–°ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            switchTab('new-stories');
            
            addLogNewStories(`âœ… ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã‚’é¸æŠã—ã¾ã—ãŸ: ${story}`);
            addLogNewStories(`ğŸ¯ å„ªå…ˆåº¦: ${priority}`);
            
            // ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£IDã‚’è¡¨ç¤º
            showUserStoryId();
        }

        // ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        async function showFixedRouteModal() {
            document.getElementById('fixedRouteModal').style.display = 'block';
            addLogAI('ğŸš€ ä¿®æ­£ãƒ«ãƒ¼ãƒˆé¸æŠç”»é¢ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
            
            // ä¿®æ­£ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
            await loadFixedRoutes();
        }

        // ä¿®æ­£ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§ã‚’èª­ã¿è¾¼ã¿
        async function loadFixedRoutes() {
            try {
                const response = await fetch('/api/results');
                const data = await response.json();
                
                // fixed_ ã§å§‹ã¾ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ•ã‚£ãƒ«ã‚¿
                const fixedRoutes = data.files
                    .filter(file => file.name.startsWith('fixed_') && file.name.endsWith('.json'))
                    .sort((a, b) => new Date(b.modified) - new Date(a.modified));
                
                const listContainer = document.getElementById('fixedRouteList');
                
                if (fixedRoutes.length === 0) {
                    listContainer.innerHTML = '<p>âŒ ä¿®æ­£ãƒ«ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</p><p>å…ˆã«ã€Œå¤±æ•—ãƒ†ã‚¹ãƒˆåˆ†æãƒ»ä¿®æ­£ã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚</p>';
                    return;
                }
                
                let html = '<div class="fixed-route-list">';
                
                fixedRoutes.forEach(route => {
                    const fileName = route.name.replace('.json', '');
                    const modifiedDate = new Date(route.modified).toLocaleString('ja-JP');
                    
                    // ãƒ•ã‚¡ã‚¤ãƒ«åã‹ã‚‰æƒ…å ±ã‚’æŠ½å‡º
                    const match = fileName.match(/fixed_(?:route_)?(\d+)_(.+)/);
                    const originalId = match ? match[1] : 'unknown';
                    const timestamp = match ? match[2] : 'unknown';
                    
                    html += `
                        <div class="route-item">
                            <h4>ğŸ”§ ${fileName}</h4>
                            <p><strong>å…ƒãƒ«ãƒ¼ãƒˆ:</strong> route_${originalId}</p>
                            <p><strong>ä¿®æ­£æ—¥æ™‚:</strong> ${modifiedDate}</p>
                            <button class="btn btn-primary" onclick="runFixedRoute('${fileName}')">
                                â–¶ï¸ å®Ÿè¡Œ
                            </button>
                        </div>
                    `;
                });
                
                html += '</div>';
                listContainer.innerHTML = html;
                
            } catch (error) {
                document.getElementById('fixedRouteList').innerHTML = `<p>âŒ ã‚¨ãƒ©ãƒ¼: ${error.message}</p>`;
            }
        }

        // ä¿®æ­£ãƒ«ãƒ¼ãƒˆã‚’å®Ÿè¡Œ
        async function runFixedRoute(routeId) {
            try {
                addLogAI(`ğŸš€ ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œé–‹å§‹: ${routeId}`);
                showStatusAI(`ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œä¸­: ${routeId}`, 'info');
                
                console.log('ğŸ› ï¸ [Debug] Sending request to:', '/api/execute-json');
                console.log('ğŸ› ï¸ [Debug] Request body:', JSON.stringify({
                    command: 'runFixedRoute',
                    routeId: routeId
                }));
                
                const response = await fetch('/api/execute-json', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        command: 'runFixedRoute',
                        routeId: routeId
                    })
                });
                
                console.log('ğŸ› ï¸ [Debug] Response status:', response.status);
                console.log('ğŸ› ï¸ [Debug] Response headers:', response.headers);
                
                const responseText = await response.text();
                console.log('ğŸ› ï¸ [Debug] Raw response:', responseText);
                
                const result = JSON.parse(responseText);
                
                if (result.success) {
                    addLogAI(`âœ… ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œå®Œäº†: ${routeId}`);
                    addLogAI(result.output);
                    showStatusAI('ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œå®Œäº†ï¼', 'success');
                    

                    
                    // ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
                    closeModal();
                    
                    // è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ç”¨ã®ãƒ†ã‚¹ãƒˆçµæœè§£æ
                    parseTestResultsAI(result.output);
                } else {
                    addLogAI(`âŒ ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    if (result.output) {
                        addLogAI(result.output);
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚è‡ªå‹•æ”¹å–„ã‚¿ãƒ–ã®ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æï¼ˆéƒ¨åˆ†çš„ãªçµæœãŒã‚ã‚‹ãŸã‚ï¼‰
                        parseTestResultsAI(result.output);
                        showStatusAI('ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œå®Œäº†ï¼ˆä¸€éƒ¨ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰', 'warning');
                    } else {
                        showStatusAI('ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œå¤±æ•—', 'error');
                    }
                }
            } catch (error) {
                addLogAI(`âŒ ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatusAI(`ä¿®æ­£ãƒ«ãƒ¼ãƒˆå®Ÿè¡Œå¤±æ•—: ${error.message}`, 'error');
            }
        }
        
        // ESCã‚­ãƒ¼ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿ã‚ªãƒ—ã‚·ãƒ§ãƒ³è¡¨ç¤ºï¼ˆå¤±æ•—åˆ†ææ™‚ã®ã¿ï¼‰
        function showManualSelectorOption() {
            const optionDiv = document.getElementById('manualSelectorOption');
            if (optionDiv) {
                optionDiv.style.display = 'block';
                addLogAI('ğŸ¯ è¦ç´ æŒ‡å®šã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚Šã¾ã—ãŸï¼ˆå¤±æ•—åˆ†ææ™‚ã®ã¿ï¼‰');
            }
        }
        
        // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿æ©Ÿèƒ½ã®åˆæœŸåŒ–
        function initializeManualSelectorFeature() {
            const enableCheckbox = document.getElementById('enableManualSelector');
            const detailsDiv = document.getElementById('manualSelectorDetails');
            const validateButton = document.getElementById('validateSelectors');
            const clearButton = document.getElementById('clearSelectors');
            const helpButton = document.getElementById('helpSelectors');
            const resultDiv = document.getElementById('selectorValidationResult');
            
            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
            enableCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    detailsDiv.style.display = 'block';
                    addLogAI('ğŸ¯ è¦ç´ æŒ‡å®šã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã—ãŸ');
                } else {
                    detailsDiv.style.display = 'none';
                    addLogAI('ğŸ¯ è¦ç´ æŒ‡å®šã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½ãŒç„¡åŠ¹ã«ãªã‚Šã¾ã—ãŸ');
                }
            });
            
            // ã‚»ãƒ¬ã‚¯ã‚¿æ¤œè¨¼ãƒœã‚¿ãƒ³
            validateButton.addEventListener('click', function() {
                const jsonText = document.getElementById('manualSelectorJson').value.trim();
                
                if (!jsonText) {
                    resultDiv.innerHTML = '<span style="color: #dc3545;">âš ï¸ ã‚»ãƒ¬ã‚¯ã‚¿JSONã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>';
                    return;
                }
                
                try {
                    const selectors = JSON.parse(jsonText);
                    let validCount = 0;
                    let totalCount = 0;
                    let f12Count = 0;
                    
                    // ã‚»ãƒ¬ã‚¯ã‚¿ã®æ§‹é€ ã‚’æ¤œè¨¼
                    for (const category in selectors) {
                        if (typeof selectors[category] === 'object') {
                            for (const item in selectors[category]) {
                                totalCount++;
                                const selectorValue = selectors[category][item];
                                if (typeof selectorValue === 'string' && selectorValue.trim()) {
                                    validCount++;
                                    
                                    // F12å½¢å¼ã‚»ãƒ¬ã‚¯ã‚¿ã®æ¤œå‡º
                                    if (selectorValue.includes('nth-child') || selectorValue.includes(' > ') || selectorValue.includes('\\:')) {
                                        f12Count++;
                                    }
                                }
                            }
                        }
                    }
                    
                    if (validCount === totalCount && totalCount > 0) {
                        let message = `âœ… å½¢å¼ãƒã‚§ãƒƒã‚¯æˆåŠŸ: ${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæ­£å¸¸ã§ã™`;
                        if (f12Count > 0) {
                            message += `<br>ğŸ“‹ F12å½¢å¼ã‚»ãƒ¬ã‚¯ã‚¿: ${f12Count}å€‹ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ã¯è‡ªå‹•å‡¦ç†ã•ã‚Œã¾ã™ï¼‰`;
                        }
                        resultDiv.innerHTML = `<span style="color: #28a745;">${message}</span>`;
                        addLogAI(`ğŸ¯ è¦ç´ æŒ‡å®šå½¢å¼ãƒã‚§ãƒƒã‚¯æˆåŠŸ: ${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæ­£å¸¸ã§ã™ï¼ˆF12å½¢å¼: ${f12Count}å€‹ï¼‰`);
                    } else {
                        resultDiv.innerHTML = `<span style="color: #ffc107;">âš ï¸ éƒ¨åˆ†çš„ã«æˆåŠŸ: ${validCount}/${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæœ‰åŠ¹ã§ã™</span>`;
                    }
                } catch (error) {
                    resultDiv.innerHTML = `<span style="color: #dc3545;">âŒ JSONå½¢å¼ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
                }
            });
            
            // ãƒ˜ãƒ«ãƒ—ãƒœã‚¿ãƒ³
            helpButton.addEventListener('click', function() {
                showSelectorHelp();
            });
            
            // ã‚¯ãƒªã‚¢ãƒœã‚¿ãƒ³
            clearButton.addEventListener('click', function() {
                document.getElementById('manualSelectorJson').value = '';
                resultDiv.innerHTML = '';
                addLogAI('ğŸ¯ è¦ç´ æŒ‡å®šãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
            });
        }
        
        // è¦ç´ æŒ‡å®šãƒ˜ãƒ«ãƒ—è¡¨ç¤º
        function showSelectorHelp() {
            const helpContent = `
ğŸ” è¦ç´ æŒ‡å®šã®æ–¹æ³•ï¼ˆQAæ‹…å½“è€…å‘ã‘ï¼‰

ã€åŸºæœ¬çš„ãªæµã‚Œã€‘
1. å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ç¢ºèª
2. å®Ÿéš›ã®Webãƒšãƒ¼ã‚¸ã‚’é–‹ã
3. è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€Œæ¤œè¨¼ã€ï¼ˆChrome/Edgeï¼‰
4. é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ã§è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ ã€ŒCopyã€â†’ ã€ŒCopy selectorã€
5. ã‚³ãƒ”ãƒ¼ã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ã‚’ãã®ã¾ã¾ä¸‹è¨˜ã®å½¢å¼ã§æŒ‡å®š

ã€F12ã‹ã‚‰ã®ã‚³ãƒ”ãƒ¼æ–¹æ³•ã€‘
â€¢ Chrome/Edge: è¦ç´ ã‚’å³ã‚¯ãƒªãƒƒã‚¯ â†’ Copy â†’ Copy selector
â€¢ ã‚³ãƒ”ãƒ¼ã•ã‚ŒãŸã‚»ãƒ¬ã‚¯ã‚¿ä¾‹:
  #__next > div:nth-child(2) > main > div > div.shops_inner__g55WC
â€¢ ã“ã®ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ãã®ã¾ã¾ä½¿ç”¨å¯èƒ½ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ã‚‚è‡ªå‹•å‡¦ç†ï¼‰

ã€ã‚ˆãä½¿ã†æŒ‡å®šæ–¹æ³•ã€‘
â€¢ F12ã‚³ãƒ”ãƒ¼: "#__next > div:nth-child(2) > main..."ï¼ˆãã®ã¾ã¾ä½¿ç”¨ï¼‰
â€¢ ãƒ†ã‚­ã‚¹ãƒˆã§æŒ‡å®š: "text=ãƒœã‚¿ãƒ³å"
â€¢ ãƒœã‚¿ãƒ³: "button:has-text(\\"ãƒœã‚¿ãƒ³å\\")"
â€¢ ãƒªãƒ³ã‚¯: "a:has-text(\\"ãƒªãƒ³ã‚¯å\\")"
â€¢ å…¥åŠ›æ¬„: "input[name=\\"é …ç›®å\\"]"
â€¢ ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³: "select[name=\\"é …ç›®å\\"]"

ã€ä¾‹ã€‘
{
  "ãƒœã‚¿ãƒ³": {
    "æ¤œç´¢": "#__next > div:nth-child(2) > main > div > button",
    "é€ä¿¡": "button:has-text(\\"é€ä¿¡\\")"
  },
  "ã‚¨ãƒªã‚¢é¸æŠ": {
    "æ±äº¬": "div.area-item:nth-child(1) > label",
    "å¤§é˜ª": "text=å¤§é˜ª"
  }
}

ã€æ³¨æ„ç‚¹ã€‘
â€¢ F12ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸã‚»ãƒ¬ã‚¯ã‚¿ã¯ãã®ã¾ã¾ä½¿ç”¨ã§ãã¾ã™
â€¢ ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ï¼ˆ\\ï¼‰ã¯è‡ªå‹•ã§å‡¦ç†ã•ã‚Œã¾ã™
â€¢ å¤±æ•—åˆ†ææ™‚ã®ã¿ä½¿ç”¨ã—ã¦ãã ã•ã„
â€¢ åˆå›ãƒ†ã‚¹ãƒˆã§ã¯ä½¿ç”¨ã—ãªã„ã§ãã ã•ã„
â€¢ åˆ†ã‹ã‚‰ãªã„å ´åˆã¯ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«ç›¸è«‡ã—ã¦ãã ã•ã„
            `;
            
            alert(helpContent);
            addLogAI('ğŸ¯ è¦ç´ æŒ‡å®šãƒ˜ãƒ«ãƒ—ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
        }
        
        // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿è¨­å®šã‚’å–å¾—
        function getManualSelectorSettings() {
            const enableManualSelector = document.getElementById('enableManualSelector').checked;
            if (!enableManualSelector) {
                return null;
            }
            
            const jsonText = document.getElementById('manualSelectorJson').value.trim();
            if (!jsonText) {
                return null;
            }
            
            try {
                return JSON.parse(jsonText);
            } catch (error) {
                addLogAI(`âš ï¸ è¦ç´ æŒ‡å®šJSONè§£æã‚¨ãƒ©ãƒ¼: ${error.message}`);
                return null;
            }
        }
        
        // ç’°å¢ƒé¸æŠå¤‰æ›´æ™‚ã®å‡¦ç†
        function onEnvironmentChange() {
            const environment = document.getElementById('executionEnvironment').value;
            const androidSettings = document.getElementById('androidSettings');
            
            if (environment === 'android') {
                androidSettings.style.display = 'block';
                addLog('ğŸ“± Androidå®Ÿæ©Ÿãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¾ã—ãŸ');
                // è‡ªå‹•çš„ã«æ¥ç¶šç¢ºèªã‚’å®Ÿè¡Œ
                setTimeout(checkADBConnection, 500);
            } else {
                androidSettings.style.display = 'none';
                addLog('ğŸ–¥ï¸ PCç‰ˆãƒ–ãƒ©ã‚¦ã‚¶ãƒ¢ãƒ¼ãƒ‰ãŒé¸æŠã•ã‚Œã¾ã—ãŸ');
            }
        }
        
        // ADBæ¥ç¶šç¢ºèª
        async function checkADBConnection() {
            const statusDiv = document.getElementById('adbStatus');
            statusDiv.className = 'adb-status checking';
            statusDiv.textContent = 'ğŸ”„ ç¢ºèªä¸­...';
            
            try {
                const response = await fetch('/api/adb-status');
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.className = 'adb-status connected';
                    statusDiv.textContent = `âœ… æ¥ç¶šæ¸ˆã¿ (${result.deviceCount}å°)`;
                    addLog(`ğŸ“± Androidå®Ÿæ©Ÿæ¥ç¶šç¢ºèª: ${result.deviceCount}å°ã®ãƒ‡ãƒã‚¤ã‚¹ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ`);
                    if (result.chromeVersion) {
                        addLog(`ğŸŒ Chrome ãƒãƒ¼ã‚¸ãƒ§ãƒ³: ${result.chromeVersion}`);
                    }
                } else {
                    statusDiv.className = 'adb-status disconnected';
                    statusDiv.textContent = 'âŒ æœªæ¥ç¶š';
                    addLog('âš ï¸ Androidå®Ÿæ©ŸãŒæ¤œå‡ºã•ã‚Œã¾ã›ã‚“ã€‚ADBè¨­å®šã‚’ç¢ºèªã—ã¦ãã ã•ã„');
                }
            } catch (error) {
                statusDiv.className = 'adb-status disconnected';
                statusDiv.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                addLog(`âŒ ADBæ¥ç¶šç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }
        
        // ADBè¨­å®šå®Ÿè¡Œ
        async function setupADBForward() {
            const statusDiv = document.getElementById('adbStatus');
            statusDiv.className = 'adb-status checking';
            statusDiv.textContent = 'ğŸ”§ è¨­å®šä¸­...';
            
            try {
                const response = await fetch('/api/adb-setup', { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    addLog('âœ… ADBãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ¯ãƒ¼ãƒ‰è¨­å®šå®Œäº†');
                    addLog('ğŸ“± Androidå®Ÿæ©Ÿã§Chromeã‚’é–‹ã„ã¦ãã ã•ã„');
                    // è¨­å®šå¾Œã«æ¥ç¶šç¢ºèªã‚’å®Ÿè¡Œ
                    setTimeout(checkADBConnection, 1000);
                } else {
                    statusDiv.className = 'adb-status disconnected';
                    statusDiv.textContent = 'âŒ è¨­å®šå¤±æ•—';
                    addLog(`âŒ ADBè¨­å®šã‚¨ãƒ©ãƒ¼: ${result.error}`);
                }
            } catch (error) {
                statusDiv.className = 'adb-status disconnected';
                statusDiv.textContent = 'âŒ ã‚¨ãƒ©ãƒ¼';
                addLog(`âŒ ADBè¨­å®šã‚¨ãƒ©ãƒ¼: ${error.message}`);
            }
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ‰ AutoPlaywright WebUI ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ');
            
            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
            document.getElementById('aiTemperature').addEventListener('input', updateTemperatureDisplay);
            document.getElementById('aiTopP').addEventListener('input', updateTopPDisplay);
            
            // æ‰‹å‹•ã‚»ãƒ¬ã‚¯ã‚¿æ©Ÿèƒ½ã®åˆæœŸåŒ–
            initializeManualSelectorFeature();
            
            // config.jsonã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã¿
            fetch('/api/config')
                .then(response => response.json())
                .then(config => {
                    if (config.targetUrl) {
                        document.getElementById('testUrl').value = config.targetUrl;
                        addLog(`ğŸ“‹ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆURLèª­ã¿è¾¼ã¿: ${config.targetUrl}`);
                    }
                    
                    // AIè¨­å®šã‚’èª­ã¿è¾¼ã¿
                    loadAIConfig(config);
                    addLog(`ğŸ¤– AIè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
                    

                    
                    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼IDè¡¨ç¤ºï¼ˆãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ç¢ºä¿ï¼‰
                    showUserStoryId();
                })
                .catch(error => {
                    addLog(`âš ï¸ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                });
        });

        // F12ã‚»ãƒ¬ã‚¯ã‚¿ç›´æ¥å…¥åŠ›æ©Ÿèƒ½
        const f12SelectorInput = document.getElementById('f12SelectorInput');
        const f12SelectorLabel = document.getElementById('f12SelectorLabel');
        const f12SelectorPreview = document.getElementById('f12SelectorPreview');
        const addF12SelectorButton = document.getElementById('addF12Selector');
        const manualSelectorJson = document.getElementById('manualSelectorJson');
        
        // F12ã‚»ãƒ¬ã‚¯ã‚¿ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤º
        f12SelectorInput.addEventListener('input', function() {
            const selector = this.value.trim();
            if (selector) {
                const normalized = normalizeF12Selector(selector);
                f12SelectorPreview.innerHTML = `<strong>æ­£è¦åŒ–å¾Œ:</strong> ${normalized}`;
                f12SelectorPreview.style.color = '#28a745';
            } else {
                f12SelectorPreview.innerHTML = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢';
                f12SelectorPreview.style.color = '#6c757d';
            }
        });
        
        // F12ã‚»ãƒ¬ã‚¯ã‚¿è¿½åŠ ãƒœã‚¿ãƒ³
        addF12SelectorButton.addEventListener('click', function() {
            const selector = f12SelectorInput.value.trim();
            const label = f12SelectorLabel.value.trim();
            
            if (!selector) {
                alert('âš ï¸ F12ã‚»ãƒ¬ã‚¯ã‚¿ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            if (!label) {
                alert('âš ï¸ è¦ç´ ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„');
                return;
            }
            
            // ç¾åœ¨ã®JSONã‚’å–å¾—
            let currentJson = {};
            const currentText = manualSelectorJson.value.trim();
            if (currentText) {
                try {
                    currentJson = JSON.parse(currentText);
                } catch (e) {
                    // æ—¢å­˜ã®JSONãŒç„¡åŠ¹ãªå ´åˆã¯æ–°ã—ãä½œæˆ
                    currentJson = {};
                }
            }
            
            // F12ã‚»ãƒ¬ã‚¯ã‚¿ã‚’æ­£è¦åŒ–ã—ã¦JSONã«è¿½åŠ 
            const normalized = normalizeF12Selector(selector);
            
            // ã‚«ãƒ†ã‚´ãƒªã‚’è‡ªå‹•åˆ¤å®šï¼ˆãƒœã‚¿ãƒ³ã€ãƒªãƒ³ã‚¯ã€å…¥åŠ›æ¬„ãªã©ï¼‰
            let category = 'ãã®ä»–';
            if (label.includes('ãƒœã‚¿ãƒ³') || label.includes('button')) {
                category = 'ãƒœã‚¿ãƒ³';
            } else if (label.includes('ãƒªãƒ³ã‚¯') || label.includes('link')) {
                category = 'ãƒªãƒ³ã‚¯';
            } else if (label.includes('å…¥åŠ›') || label.includes('input')) {
                category = 'å…¥åŠ›æ¬„';
            } else if (label.includes('ãƒã‚§ãƒƒã‚¯') || label.includes('checkbox')) {
                category = 'ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹';
            } else if (label.includes('ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³') || label.includes('select')) {
                category = 'ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³';
            }
            
            // JSONã«è¿½åŠ 
            if (!currentJson[category]) {
                currentJson[category] = {};
            }
            currentJson[category][label] = normalized;
            
            // JSONã‚’æ•´å½¢ã—ã¦è¡¨ç¤º
            manualSelectorJson.value = JSON.stringify(currentJson, null, 2);
            
            // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            f12SelectorInput.value = '';
            f12SelectorLabel.value = '';
            f12SelectorPreview.innerHTML = 'ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã‚¨ãƒªã‚¢';
            f12SelectorPreview.style.color = '#6c757d';
            
            // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
            const successMsg = document.createElement('div');
            successMsg.style.cssText = 'position: fixed; top: 20px; right: 20px; background: #28a745; color: white; padding: 10px 20px; border-radius: 4px; z-index: 1000;';
            successMsg.textContent = `âœ… ${label} ã‚’è¿½åŠ ã—ã¾ã—ãŸ`;
            document.body.appendChild(successMsg);
            setTimeout(() => successMsg.remove(), 3000);
        });
        
        // F12ã‚»ãƒ¬ã‚¯ã‚¿ã®æ­£è¦åŒ–é–¢æ•°
        function normalizeF12Selector(selector) {
            if (!selector) return '';
            
            // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ã®æ­£è¦åŒ–
            let normalized = selector
                .replace(/\\\\/g, '\\')  // äºŒé‡ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚’å˜ä¸€ã«
                .replace(/\\:/g, ':')    // ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã•ã‚ŒãŸã‚³ãƒ­ãƒ³ã‚’æ­£è¦åŒ–
                .replace(/\s+/g, ' ')    // è¤‡æ•°ã‚¹ãƒšãƒ¼ã‚¹ã‚’å˜ä¸€ã«
                .trim();                 // å‰å¾Œã®ç©ºç™½ã‚’é™¤å»
            
            return normalized;
        }
        
        // ã‚»ãƒ¬ã‚¯ã‚¿æ¤œè¨¼ãƒœã‚¿ãƒ³
        validateSelectors.addEventListener('click', function() {
            const jsonText = document.getElementById('manualSelectorJson').value.trim();
            
            if (!jsonText) {
                resultDiv.innerHTML = '<span style="color: #dc3545;">âš ï¸ ã‚»ãƒ¬ã‚¯ã‚¿JSONã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</span>';
                return;
            }
            
            try {
                const selectors = JSON.parse(jsonText);
                let validCount = 0;
                let totalCount = 0;
                let f12Count = 0;
                
                // ã‚»ãƒ¬ã‚¯ã‚¿ã®æ§‹é€ ã‚’æ¤œè¨¼
                for (const category in selectors) {
                    if (typeof selectors[category] === 'object') {
                        for (const item in selectors[category]) {
                            totalCount++;
                            const selectorValue = selectors[category][item];
                            if (typeof selectorValue === 'string' && selectorValue.trim()) {
                                validCount++;
                                
                                // F12å½¢å¼ã‚»ãƒ¬ã‚¯ã‚¿ã®æ¤œå‡º
                                if (selectorValue.includes('nth-child') || selectorValue.includes(' > ') || selectorValue.includes('\\:')) {
                                    f12Count++;
                                }
                            }
                        }
                    }
                }
                
                if (validCount === totalCount && totalCount > 0) {
                    let message = `âœ… å½¢å¼ãƒã‚§ãƒƒã‚¯æˆåŠŸ: ${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæ­£å¸¸ã§ã™`;
                    if (f12Count > 0) {
                        message += `<br>ğŸ“‹ F12å½¢å¼ã‚»ãƒ¬ã‚¯ã‚¿: ${f12Count}å€‹ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—æ–‡å­—ã¯è‡ªå‹•å‡¦ç†ã•ã‚Œã¾ã™ï¼‰`;
                    }
                    resultDiv.innerHTML = `<span style="color: #28a745;">${message}</span>`;
                    addLogAI(`ğŸ¯ è¦ç´ æŒ‡å®šå½¢å¼ãƒã‚§ãƒƒã‚¯æˆåŠŸ: ${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæ­£å¸¸ã§ã™ï¼ˆF12å½¢å¼: ${f12Count}å€‹ï¼‰`);
                } else {
                    resultDiv.innerHTML = `<span style="color: #ffc107;">âš ï¸ éƒ¨åˆ†çš„ã«æˆåŠŸ: ${validCount}/${totalCount}å€‹ã®è¦ç´ æŒ‡å®šãŒæœ‰åŠ¹ã§ã™</span>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<span style="color: #dc3545;">âŒ JSONå½¢å¼ã‚¨ãƒ©ãƒ¼: ${error.message}</span>`;
            }
        });

    </script>
</body>
</html> 