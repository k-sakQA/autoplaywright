<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoPlaywright - ãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #ecf0f1;
            border-radius: 10px;
            background: #fafafa;
        }
        
        .section h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
        }
        
        .section h2::before {
            content: "âš™ï¸";
            margin-right: 10px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #34495e;
        }
        
        input[type="url"], input[type="file"], textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #bdc3c7;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            font-family: inherit;
        }
        
        input[type="url"]:focus, input[type="file"]:focus, textarea:focus {
            outline: none;
            border-color: #3498db;
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .buttons-section h2::before {
            content: "ğŸš€";
        }
        
        .button-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        button {
            padding: 15px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #1abc9c, #16a085);
            color: white;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(26, 188, 156, 0.4);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }
        
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.4);
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
        }
        
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }
        
        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }
        
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23, 162, 184, 0.4);
        }
        
        .manual-guide-btn {
            width: 100%;
            margin-bottom: 10px;
        }
        
        .log-area {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            height: 200px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .status {
            margin-top: 15px;
            padding: 10px;
            border-radius: 5px;
            font-weight: 600;
            text-align: center;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
        }
        
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        
        /* ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            z-index: 1001;
        }
        
        .modal-header {
            background: linear-gradient(135deg, #2c3e50, #3498db);
            color: white;
            padding: 20px 30px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s ease;
        }
        
        .close-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .modal-body {
            padding: 30px;
            line-height: 1.6;
        }
        
        .modal-body h3 {
            color: #2c3e50;
            margin-top: 25px;
            margin-bottom: 15px;
            font-size: 1.3rem;
        }
        
        .modal-body h3:first-child {
            margin-top: 0;
        }
        
        .modal-body pre {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            overflow-x: auto;
            font-size: 14px;
            margin: 15px 0;
        }
        
        .modal-body code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 2px 6px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
        }
        
        .modal-body ul, .modal-body ol {
            margin: 15px 0;
            padding-left: 25px;
        }
        
        .modal-body li {
            margin-bottom: 8px;
        }
        
        .highlight-box {
            background: #e8f5e8;
            border-left: 4px solid #28a745;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 8px 8px 0;
        }
        
        /* ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .test-summary {
            margin-top: 20px;
            padding: 20px;
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border: 2px solid #28a745;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(40, 167, 69, 0.2);
        }
        
        .test-summary h3 {
            margin: 0 0 15px 0;
            color: #155724;
            font-size: 1.2rem;
            text-align: center;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border-left: 4px solid #6c757d;
        }
        
        .summary-item.success {
            border-left-color: #28a745;
        }
        
        .summary-item.error {
            border-left-color: #dc3545;
        }
        
        .summary-label {
            font-weight: 600;
            color: #495057;
        }
        
        .summary-value {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2c3e50;
        }
        
        .failed-tests {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            border-radius: 6px;
            padding: 15px;
            margin-top: 15px;
        }
        
        .failed-tests h4 {
            margin: 0 0 10px 0;
            color: #721c24;
            font-size: 1rem;
        }
        
        .failed-tests ul {
            margin: 0;
            padding: 0;
            list-style: none;
        }
        
        .failed-tests li {
            background: white;
            border: 1px solid #f5c6cb;
            border-radius: 4px;
            padding: 10px;
            margin-bottom: 8px;
            color: #721c24;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            font-size: 0.9rem;
            line-height: 1.4;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .failed-tests li:last-child {
            margin-bottom: 0;
        }
        
        .failed-tests li::before {
            content: "âŒ ";
            font-weight: bold;
            margin-right: 5px;
        }
        
        /* AIè¨­å®šãƒ‘ãƒãƒ«ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .ai-config-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 768px) {
            .ai-config-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .ai-config-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .form-group small {
            display: block;
            margin-top: 5px;
            color: #6c757d;
            font-size: 0.85rem;
        }
        
        .form-group input[type="range"] {
            width: 100%;
            margin: 8px 0;
        }
        
        .form-group input[type="number"] {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
        }
        
        .form-group select {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e1e5e9;
            border-radius: 6px;
            font-size: 1rem;
            background-color: white;
        }
        
        .form-group select:focus,
        .form-group input[type="number"]:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>AutoPlaywright</h1>
            <p>Playwrightã‚’ä½¿ç”¨ã—ãŸE2Eãƒ†ã‚¹ãƒˆè‡ªå‹•ç”Ÿæˆãƒ„ãƒ¼ãƒ«</p>
        </div>
        
        <div class="content">
            <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>åŸºæœ¬è¨­å®š</h2>
                
                <div class="form-group">
                    <label for="testUrl">ãƒ†ã‚¹ãƒˆå¯¾è±¡URL:</label>
                    <input type="url" id="testUrl" placeholder="https://example.com" value="">
                </div>
                
                <div class="form-group">
                    <label for="testGoal">ãƒ†ã‚¹ãƒˆå¯¾è±¡ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ã¨ä¸»ãªãƒ«ãƒ¼ãƒˆ:</label>
                    <textarea id="testGoal" rows="3" placeholder="ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ï¼šå®¿æ³Šäºˆç´„ã®å…¥åŠ›ãƒ»é¸æŠãŒã§ãã‚‹&#10;ãƒ«ãƒ¼ãƒˆï¼šã€å®¿æ³Šäºˆç´„ç”»é¢ã§å„é …ç›®ã«æœ‰åŠ¹ãªå€¤ã‚’å…¥åŠ›ã€ã¾ãŸã¯é¸æŠã—ã¦ã€Œäºˆç´„å†…å®¹ã‚’ç¢ºèªã™ã‚‹ã€ã‚’æŠ¼ä¸‹ã™ã‚‹ã¨ã€ã€Œå®¿æ³Šäºˆç´„ç¢ºèªã€ç”»é¢ã«å€¤ãŒåæ˜ ã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹"></textarea>
                    <small>å…·ä½“çš„ãªãƒ†ã‚¹ãƒˆæ‰‹é †ã‚„ç¢ºèªã—ãŸã„å†…å®¹ã‚’è¨˜è¿°ã—ã¦ãã ã•ã„</small>
                </div>
                
                <div class="form-group">
                    <label for="csvFile">ãƒ†ã‚¹ãƒˆè¦³ç‚¹CSV (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <input type="file" id="csvFile" accept=".csv">
                    <small>æŒ‡å®šã—ãªã„å ´åˆã¯æ¨™æº–ã®ãƒ†ã‚¹ãƒˆè¦³ç‚¹ã‚’ä½¿ç”¨ã—ã¾ã™</small>
                </div>
                
                <div class="form-group">
                    <label for="pdfFile">ä»•æ§˜æ›¸PDF (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <input type="file" id="pdfFile" accept=".pdf">
                </div>
                

            </div>
            
            <!-- å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section buttons-section">
                <h2>ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</h2>
                
                <div class="button-grid">
                    <button class="btn-primary" onclick="executeCommand('generateTestPoints')">
                        ğŸ“‹ ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ
                    </button>
                    
                    <button class="btn-info" onclick="executeCommand('generateSmartRoutes')">
                        ğŸ§  ã‚¹ãƒãƒ¼ãƒˆã‚·ãƒŠãƒªã‚ªç”Ÿæˆ
                    </button>
                    
                    <button class="btn-success" onclick="executeCommand('runRoutes')">
                        â–¶ï¸ ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
                    </button>
                    
                    <button class="btn-warning" onclick="executeCommand('generateTestReport')">
                        ğŸ“Š ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
                    </button>
                </div>
                
                <div id="status" class="status" style="display: none;"></div>
                
                <!-- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœã‚µãƒãƒªãƒ¼ -->
                <div id="testSummary" class="test-summary" style="display: none;">
                    <h3>ğŸ“Š ãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <span class="summary-label">ğŸ”· ãƒ†ã‚¹ãƒˆID:</span>
                            <span id="testId" class="summary-value">-</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:</span>
                            <span id="totalSteps" class="summary-value">-</span>
                        </div>
                        <div class="summary-item success">
                            <span class="summary-label">âœ… æˆåŠŸæ•°:</span>
                            <span id="successCount" class="summary-value">-</span>
                        </div>
                        <div class="summary-item error">
                            <span class="summary-label">âŒ å¤±æ•—æ•°:</span>
                            <span id="failureCount" class="summary-value">-</span>
                        </div>
                    </div>
                    <div id="failedTests" class="failed-tests" style="display: none;">
                        <h4>âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:</h4>
                        <ul id="failedTestsList"></ul>
                    </div>
                </div>
                
                <div class="log-area" id="logArea">
                    å®Ÿè¡Œãƒ­ã‚°ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...
                </div>
            </div>
            
            <!-- AIè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ¤– AIè¨­å®š</h2>
                
                <div class="ai-config-grid">
                    <div class="form-group">
                        <label for="aiModel">ãƒ¢ãƒ‡ãƒ«:</label>
                        <select id="aiModel">
                            <option value="gpt-4o-mini">GPT-4o Mini (æ¨å¥¨)</option>
                            <option value="gpt-4o">GPT-4o</option>
                            <option value="gpt-4-turbo">GPT-4 Turbo</option>
                            <option value="gpt-3.5-turbo">GPT-3.5 Turbo</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiTemperature">å‰µé€ æ€§ (Temperature): <span id="temperatureValue">0.5</span></label>
                        <input type="range" id="aiTemperature" min="0" max="1" step="0.1" value="0.5">
                        <small>0.0: æ±ºå®šçš„, 1.0: å‰µé€ çš„</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiMaxTokens">æœ€å¤§ãƒˆãƒ¼ã‚¯ãƒ³æ•°:</label>
                        <input type="number" id="aiMaxTokens" min="1000" max="8000" step="500" value="4000">
                        <small>1000-8000 (å¤šã„ã»ã©è©³ç´°ãªå›ç­”)</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="aiTopP">Top-p: <span id="topPValue">0.9</span></label>
                        <input type="range" id="aiTopP" min="0.1" max="1" step="0.1" value="0.9">
                        <small>0.1: é›†ä¸­çš„, 1.0: å¤šæ§˜æ€§</small>
                    </div>
                </div>
                
                <div class="ai-config-actions">
                    <button type="button" class="btn-secondary" onclick="resetAIConfig()">
                        ğŸ”„ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™
                    </button>
                    <button type="button" class="btn-primary" onclick="saveAIConfig()">
                        ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                    </button>
                </div>
            </div>
            
            <!-- Google Sheetsè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ“ˆ Google Sheetsè¨­å®š</h2>
                
                <div class="form-group">
                    <label for="shareEmail">å…±æœ‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹:</label>
                    <input type="email" id="shareEmail" placeholder="your-email@gmail.com" value="sakata1977@gmail.com">
                    <small>ä½œæˆã•ã‚ŒãŸã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’å…±æœ‰ã™ã‚‹Googleã‚¢ã‚«ã‚¦ãƒ³ãƒˆ</small>
                </div>
                
                <div class="form-group">
                    <label for="driveFolder">ä¿å­˜ãƒ•ã‚©ãƒ«ãƒ€ID (ã‚ªãƒ—ã‚·ãƒ§ãƒ³):</label>
                    <input type="text" id="driveFolder" placeholder="1yx5b2egdjrtB4LTIruSatikTcTW7KOSD">
                    <small>Google Driveã®ãƒ•ã‚©ãƒ«ãƒ€IDã‚’æŒ‡å®šã™ã‚‹ã¨ã€ãã®ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã•ã‚Œã¾ã™</small>
                </div>
                
                <div class="form-group">
                    <label for="spreadsheetTitle">ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚¿ã‚¤ãƒˆãƒ«:</label>
                    <input type="text" id="spreadsheetTitle" value="AutoPlaywright ãƒ†ã‚¹ãƒˆçµæœ" placeholder="ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆå">
                </div>
                
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="autoUpload" checked>
                        ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå¾Œã«è‡ªå‹•ã§Google Sheetsã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
                    </label>
                </div>
                
                <div class="ai-config-actions">
                    <button type="button" class="btn-info" onclick="testGoogleSheetsConnection()">
                        ğŸ”— æ¥ç¶šãƒ†ã‚¹ãƒˆ
                    </button>
                    <button type="button" class="btn-primary" onclick="saveGoogleSheetsConfig()">
                        ğŸ’¾ è¨­å®šã‚’ä¿å­˜
                    </button>
                </div>
            </div>
            
            <!-- æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä½œæˆ</h2>
                
                <div class="form-group">
                    <button type="button" class="btn-info manual-guide-btn" onclick="showManualGuide()">
                        ğŸ“‹ æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ä½œæˆã™ã‚‹æ–¹æ³•
                    </button>
                    <small>AIãŒç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã«æº€è¶³ã§ããªã„å ´åˆã®ä»£æ›¿æ‰‹æ®µ</small>
                </div>
            </div>
        </div>
    </div>

    <!-- æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
    <div id="manualGuideModal" class="modal-overlay" onclick="closeModal(event)">
        <div class="modal" onclick="event.stopPropagation()">
            <div class="modal-header">
                <h2>ğŸ“‹ æ‰‹å‹•ã§ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã‚’ä½œæˆã™ã‚‹æ–¹æ³•</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <h3>ğŸ¯ æ¦‚è¦</h3>
                <p>AIãŒç”Ÿæˆã™ã‚‹ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªã«æº€è¶³ã§ããªã„å ´åˆã€æ‰‹å‹•ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ã‚ˆã‚Šç²¾å¯†ãªãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚</p>
                
                <div class="highlight-box">
                    <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ:</strong> æ‰‹å‹•ä½œæˆã«ã‚ˆã‚Šã€AIã§ã¯å¯¾å¿œã§ããªã„è¤‡é›‘ãªãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ­ãƒ¼ã‚„ç‰¹å®šã®è¦ç´ ã‚’æ­£ç¢ºã«ãƒ†ã‚¹ãƒˆã§ãã¾ã™ã€‚
                </div>

                <h3>ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®å ´æ‰€</h3>
                <p>ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«æ‰‹å‹•ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                <pre><code>test-results/route_yymmddhhmmss.json</code></pre>
                <p>ãƒ•ã‚¡ã‚¤ãƒ«åã®å½¢å¼ï¼š<code>route_</code> + å¹´æœˆæ—¥æ™‚åˆ†ç§’ + <code>.json</code></p>
                <p>ä¾‹ï¼š<code>route_250623145230.json</code> (2025å¹´06æœˆ23æ—¥ 14æ™‚52åˆ†30ç§’)</p>

                <h3>ğŸ“ JSONæ§‹é€ </h3>
                <p>ä»¥ä¸‹ã®æ§‹é€ ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦ãã ã•ã„ï¼š</p>
                <pre><code>{
  "route_id": "manual_test_001",
  "steps": [
    {
      "label": "ã‚¹ãƒ†ãƒƒãƒ—ã®èª¬æ˜",
      "action": "ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å",
      "target": "ã‚»ãƒ¬ã‚¯ã‚¿ã¾ãŸã¯URL",
      "value": "å…¥åŠ›å€¤ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰"
    }
  ]
}</code></pre>

                <h3>ğŸ”§ åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³</h3>
                <ul>
                    <li><code>load</code> - ãƒšãƒ¼ã‚¸ã‚’èª­ã¿è¾¼ã‚€</li>
                    <li><code>click</code> - è¦ç´ ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹</li>
                    <li><code>fill</code> - å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã«å€¤ã‚’å…¥åŠ›ã™ã‚‹</li>
                    <li><code>assertVisible</code> - è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹</li>
                    <li><code>assertNotVisible</code> - è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹</li>
                    <li><code>waitForSelector</code> - è¦ç´ ãŒç¾ã‚Œã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹</li>
                    <li><code>waitForURL</code> - ç‰¹å®šã®URLã«é·ç§»ã™ã‚‹ã¾ã§å¾…æ©Ÿã™ã‚‹</li>
                </ul>

                <h3>ğŸ“‹ å®Œå…¨ãªä¾‹</h3>
                <pre><code>{
  "route_id": "manual_login_test",
  "steps": [
    {
      "label": "ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã‚’é–‹ã",
      "action": "load",
      "target": "https://example.com/login"
    },
    {
      "label": "ãƒ¦ãƒ¼ã‚¶ãƒ¼åã‚’å…¥åŠ›",
      "action": "fill",
      "target": "input[name='username']",
      "value": "testuser"
    },
    {
      "label": "ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›",
      "action": "fill",
      "target": "input[name='password']",
      "value": "testpass123"
    },
    {
      "label": "ãƒ­ã‚°ã‚¤ãƒ³ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯",
      "action": "click",
      "target": "button[type='submit']"
    },
    {
      "label": "ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãƒšãƒ¼ã‚¸ã«é·ç§»ç¢ºèª",
      "action": "waitForURL",
      "target": "**/dashboard**"
    },
    {
      "label": "ã‚ˆã†ã“ããƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèª",
      "action": "assertVisible",
      "target": ".welcome-message"
    }
  ]
}</code></pre>

                <h3>âš ï¸ æ³¨æ„äº‹é …</h3>
                <div class="warning-box">
                    <ul>
                        <li>JSONã®æ§‹æ–‡ã‚¨ãƒ©ãƒ¼ãŒãªã„ã‚ˆã†æ³¨æ„ã—ã¦ãã ã•ã„</li>
                        <li>ã‚»ãƒ¬ã‚¯ã‚¿ã¯å®Ÿéš›ã«ãƒšãƒ¼ã‚¸ã«å­˜åœ¨ã™ã‚‹è¦ç´ ã‚’æŒ‡å®šã—ã¦ãã ã•ã„</li>
                        <li>è¤‡æ•°ã®å€™è£œã‚»ãƒ¬ã‚¯ã‚¿ã‚’ã‚«ãƒ³ãƒåŒºåˆ‡ã‚Šã§æŒ‡å®šã§ãã¾ã™ï¼ˆä¾‹ï¼š<code>"h1, .title, #main-title"</code>ï¼‰</li>
                        <li>ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å¾Œã€ãƒ†ã‚¹ãƒˆå®Ÿè¡Œãƒœã‚¿ãƒ³ã§è‡ªå‹•çš„ã«æœ€æ–°ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™</li>
                    </ul>
                </div>

                <h3>ğŸ” ã‚»ãƒ¬ã‚¯ã‚¿ã®ã‚³ãƒ„</h3>
                <ul>
                    <li><strong>IDé¸æŠ:</strong> <code>#element-id</code></li>
                    <li><strong>ã‚¯ãƒ©ã‚¹é¸æŠ:</strong> <code>.class-name</code></li>
                    <li><strong>å±æ€§é¸æŠ:</strong> <code>input[type="email"]</code></li>
                    <li><strong>ãƒ†ã‚­ã‚¹ãƒˆé¸æŠ:</strong> <code>text=ãƒ­ã‚°ã‚¤ãƒ³</code></li>
                    <li><strong>è¤‡åˆé¸æŠ:</strong> <code>form input[type="submit"]</code></li>
                    <li><strong>è¤‡æ•°å€™è£œ:</strong> <code>button, .btn, [type="submit"]</code></li>
                </ul>

                <div class="highlight-box">
                    <strong>ğŸš€ ãƒ—ãƒ­ã®ã‚³ãƒ„:</strong> ãƒ–ãƒ©ã‚¦ã‚¶ã®é–‹ç™ºè€…ãƒ„ãƒ¼ãƒ«ï¼ˆF12ã‚­ãƒ¼ï¼‰ã§ã‚»ãƒ¬ã‚¯ã‚¿ã‚’ãƒ†ã‚¹ãƒˆã—ã¦ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ã¨ç¢ºå®Ÿã§ã™ï¼
                </div>
            </div>
        </div>
    </div>

    <script>
        // ãƒ­ã‚°ã‚¨ãƒªã‚¢ã«è¿½åŠ ã™ã‚‹é–¢æ•°
        function addLog(message, type = 'info') {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
        }

        // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤ºé–¢æ•°
        function showStatus(message, type) {
            const statusEl = document.getElementById('status');
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
            statusEl.style.display = 'block';
        }

        // ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œé–¢æ•°
        async function executeCommand(command) {
            const url = document.getElementById('testUrl').value;
            const testGoal = document.getElementById('testGoal').value;
            const pdfFile = document.getElementById('pdfFile').files[0];
            const csvFile = document.getElementById('csvFile').files[0];
            
            // URLå…¥åŠ›ãƒã‚§ãƒƒã‚¯
            if (!url && command !== 'runRoutes' && command !== 'generateTestReport') {
                showStatus('ãƒ†ã‚¹ãƒˆå¯¾è±¡URLã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            addLog(`ğŸš€ ${getCommandName(command)} ã‚’é–‹å§‹ã—ã¦ã„ã¾ã™...`);
            showStatus(`${getCommandName(command)} å®Ÿè¡Œä¸­...`, 'info');
            
            try {
                const formData = new FormData();
                formData.append('command', command);
                if (url) formData.append('url', url);
                if (testGoal) formData.append('goal', testGoal);
                if (pdfFile) formData.append('pdf', pdfFile);
                if (csvFile) formData.append('csv', csvFile);
                
                const response = await fetch('/api/execute', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… ${getCommandName(command)} ãŒæ­£å¸¸ã«å®Œäº†ã—ã¾ã—ãŸ`);
                    if (result.output) {
                        addLog(result.output);
                        
                        // runRoutesã‚³ãƒãƒ³ãƒ‰ã®å ´åˆã€ãƒ†ã‚¹ãƒˆçµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Full output for parsing:', result.output);
                            parseTestResults(result.output);
                            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®å ´åˆã¯ç‰¹åˆ¥ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                            showStatus(`ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼`, 'success');
                        } else {
                            showStatus(`${getCommandName(command)} å®Œäº†`, 'success');
                        }
                    } else {
                        showStatus(`${getCommandName(command)} å®Œäº†`, 'success');
                    }
                } else {
                    addLog(`âŒ ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    if (result.output) {
                        addLog(result.output);
                        
                        // ã‚¨ãƒ©ãƒ¼ã§ã‚‚runRoutesã®å ´åˆã¯çµæœã‚’è§£æ
                        if (command === 'runRoutes') {
                            console.log('ğŸ› ï¸ [Debug] Error output for parsing:', result.output);
                            parseTestResults(result.output);
                            // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®å ´åˆã¯ç‰¹åˆ¥ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤º
                            showStatus(`ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œã—ã¾ã—ãŸï¼ï¼ˆä¸€éƒ¨ã‚¨ãƒ©ãƒ¼ã‚ã‚Šï¼‰`, 'warning');
                        } else {
                            showStatus(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                        }
                    } else {
                        showStatus(`ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${result.error}`, 'error');
                    }
                }
            } catch (error) {
                addLog(`âŒ é€šä¿¡ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatus(`é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ`, 'error');
            }
        }
        
        // ã‚³ãƒãƒ³ãƒ‰åå–å¾—
        function getCommandName(command) {
            const names = {
                'generateTestPoints': 'ãƒ†ã‚¹ãƒˆè¦³ç‚¹ç”Ÿæˆ',
                'generateSmartRoutes': 'ã‚¹ãƒãƒ¼ãƒˆã‚·ãƒŠãƒªã‚ªç”Ÿæˆ',
                'runRoutes': 'ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ',
                'generateTestReport': 'ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ'
            };
            return names[command] || command;
        }

        // ãƒ†ã‚¹ãƒˆçµæœè§£æé–¢æ•°
        function parseTestResults(output) {
            try {
                console.log('ğŸ› ï¸ [Debug] Parsing test results...');
                const lines = output.split('\n');
                let testId = '-';
                let totalSteps = '-';
                let successCount = '-';
                let failureCount = '-';
                const failedTests = [];
                let resultFilePath = '';
                
                let inFailedSection = false;
                
                console.log('ğŸ› ï¸ [Debug] Total lines to parse:', lines.length);
                
                for (const line of lines) {
                    // ãƒ†ã‚¹ãƒˆIDã®æŠ½å‡º
                    const testIdMatch = line.match(/ğŸ”· ãƒ†ã‚¹ãƒˆID:\s*(.+)/);
                    if (testIdMatch) {
                        testId = testIdMatch[1].trim();
                    }
                    
                    // ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°ã®æŠ½å‡º
                    const totalStepsMatch = line.match(/ğŸ”· ç·ã‚¹ãƒ†ãƒƒãƒ—æ•°:\s*(\d+)/);
                    if (totalStepsMatch) {
                        totalSteps = totalStepsMatch[1];
                    }
                    
                    // æˆåŠŸæ•°ã®æŠ½å‡º
                    const successMatch = line.match(/ğŸ”· æˆåŠŸæ•°:\s*(\d+)/);
                    if (successMatch) {
                        successCount = successMatch[1];
                    }
                    
                    // å¤±æ•—æ•°ã®æŠ½å‡º
                    const failureMatch = line.match(/ğŸ”· å¤±æ•—æ•°:\s*(\d+)/);
                    if (failureMatch) {
                        failureCount = failureMatch[1];
                    }
                    
                    // çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®æŠ½å‡º
                    const resultFileMatch = line.match(/ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ:\s*(.+\.json)/);
                    if (resultFileMatch) {
                        resultFilePath = resultFileMatch[1].trim();
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹
                    if (line.includes('âŒ å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹:')) {
                        inFailedSection = true;
                        continue;
                    }
                    
                    // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æŠ½å‡ºï¼ˆã‚ˆã‚Šæ­£ç¢ºãªè§£æï¼‰
                    if (inFailedSection) {
                        // "  - " ã§å§‹ã¾ã‚‹è¡Œã‚’æŠ½å‡º
                        const failedTestMatch = line.match(/^\s*-\s*(.+)/);
                        if (failedTestMatch) {
                            const failedTest = cleanErrorMessage(failedTestMatch[1].trim());
                            if (failedTest.trim()) {
                                failedTests.push(failedTest);
                            }
                        }
                        
                        // ã‚»ã‚¯ã‚·ãƒ§ãƒ³çµ‚äº†åˆ¤å®šï¼ˆç©ºè¡Œã¾ãŸã¯æ¬¡ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³é–‹å§‹ï¼‰
                        if (line.trim() === '' || line.includes('ğŸ“ ãƒ†ã‚¹ãƒˆçµæœã‚’ä¿å­˜ã—ã¾ã—ãŸ')) {
                            inFailedSection = false;
                        }
                    }
                }
                
                // ã‚µãƒãƒªãƒ¼è¡¨ç¤º
                console.log('ğŸ› ï¸ [Debug] Extracted data:', {testId, totalSteps, successCount, failureCount, failedTestsCount: failedTests.length, resultFilePath});
                displayTestSummary(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath);
                
            } catch (error) {
                console.error('ãƒ†ã‚¹ãƒˆçµæœè§£æã‚¨ãƒ©ãƒ¼:', error);
                addLog(`âš ï¸ ãƒ†ã‚¹ãƒˆçµæœã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: ${error.message}`);
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´ç†ã™ã‚‹é–¢æ•°
        function cleanErrorMessage(message) {
            console.log('ğŸ› ï¸ [Debug] Original message:', message); // ãƒ‡ãƒãƒƒã‚°ç”¨
            
            // æ”¹è¡Œã‚’å«ã‚€é•·ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ•´ç†
            let cleanedMessage = message;
            
            // ã¾ãšã€ã‚³ãƒ­ãƒ³ã§ãƒ†ã‚¹ãƒˆåã¨ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’åˆ†é›¢
            const colonIndex = cleanedMessage.indexOf(':');
            let testName = '';
            let errorPart = cleanedMessage;
            
            if (colonIndex > 0 && colonIndex < 100) {
                testName = cleanedMessage.substring(0, colonIndex).trim();
                errorPart = cleanedMessage.substring(colonIndex + 1).trim();
            }
            
            // ã‚¨ãƒ©ãƒ¼éƒ¨åˆ†ã‚’ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
            // é•·ã„ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\/Users\/[^\s]*\/autoplaywright\/[^\s]*/g, '');
            
            // PlaywrightRunner.executeStep ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*at\s+PlaywrightRunner\.executeStep[\s\S]*$/g, '');
            
            // Call log ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/Call\s+log:\s*[\s\S]*$/g, '');
            
            // ANSI ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\[\d+m/g, '');
            
            // ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹ã® at xxx éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*at\s+[^\n]*/g, '');
            
            // { name: 'TimeoutError' } ã®éƒ¨åˆ†ã‚’å‰Šé™¤
            errorPart = errorPart.replace(/\s*\{\s*name:\s*['"][^'"]*['"]\s*\}/g, '');
            
            // è¤‡æ•°ã®ã‚¹ãƒšãƒ¼ã‚¹ã‚„æ”¹è¡Œã‚’å˜ä¸€ã‚¹ãƒšãƒ¼ã‚¹ã«
            errorPart = errorPart.replace(/\s+/g, ' ').trim();
            
            // ä¸»è¦ãªã‚¨ãƒ©ãƒ¼ã‚¿ã‚¤ãƒ—ã«åŸºã¥ã„ã¦ç°¡æ½”ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«å¤‰æ›
            const errorPatterns = [
                {
                    pattern: /page\.waitForSelector:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ è¦ç´ å¾…æ©Ÿã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.click:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ ã‚¯ãƒªãƒƒã‚¯ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.fill:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ å…¥åŠ›ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /page\.fill:\s*Error:\s*Element\s+is\s+not\s+an\s+<input>/i,
                    replacement: 'ğŸš« å…¥åŠ›è¦ç´ ã§ã¯ã‚ã‚Šã¾ã›ã‚“'
                },
                {
                    pattern: /page\.waitForURL:\s*Timeout\s+(\d+)ms\s+exceeded/i,
                    replacement: 'â±ï¸ URLé·ç§»ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ ($1ms)'
                },
                {
                    pattern: /element\s+is\s+not\s+visible/i,
                    replacement: 'ğŸ‘ï¸ è¦ç´ ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã¾ã›ã‚“'
                },
                {
                    pattern: /element\s+is\s+disabled/i,
                    replacement: 'ğŸš« è¦ç´ ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™'
                },
                {
                    pattern: /waiting\s+for\s+element\s+to\s+be\s+visible,\s+enabled\s+and\s+editable/i,
                    replacement: 'â³ è¦ç´ ãŒç·¨é›†å¯èƒ½ã«ãªã‚‹ã¾ã§å¾…æ©Ÿä¸­'
                }
            ];
            
            // ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯ã—ã¦ç½®æ›
            let finalError = errorPart;
            for (const {pattern, replacement} of errorPatterns) {
                if (pattern.test(errorPart)) {
                    finalError = errorPart.replace(pattern, replacement);
                    break;
                }
            }
            
            // ãƒ‘ã‚¿ãƒ¼ãƒ³ã«ãƒãƒƒãƒã—ãªã„å ´åˆã®ä¸€èˆ¬çš„ãªã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°
            if (finalError === errorPart) {
                if (finalError.includes('Timeout') && finalError.includes('exceeded')) {
                    finalError = 'â±ï¸ ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚¨ãƒ©ãƒ¼';
                } else if (finalError.includes('Error:')) {
                    const errorIndex = finalError.indexOf('Error:');
                    finalError = 'âŒ ' + finalError.substring(errorIndex + 6).trim();
                }
            }
            
            // æœ€çµ‚çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’æ§‹ç¯‰
            let result = testName ? `${testName}: ${finalError}` : finalError;
            
            // é•·ã™ãã‚‹å ´åˆã¯çŸ­ç¸®
            if (result.length > 150) {
                result = result.substring(0, 147) + '...';
            }
            
            console.log('ğŸ› ï¸ [Debug] Cleaned message:', result); // ãƒ‡ãƒãƒƒã‚°ç”¨
            return result;
        }

        // ãƒ†ã‚¹ãƒˆã‚µãƒãƒªãƒ¼è¡¨ç¤ºé–¢æ•°
        function displayTestSummary(testId, totalSteps, successCount, failureCount, failedTests, resultFilePath) {
            // å€¤ã‚’è¨­å®š
            document.getElementById('testId').textContent = testId;
            document.getElementById('totalSteps').textContent = totalSteps;
            document.getElementById('successCount').textContent = successCount;
            document.getElementById('failureCount').textContent = failureCount;
            
            // å¤±æ•—ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®è¡¨ç¤º
            const failedTestsSection = document.getElementById('failedTests');
            const failedTestsList = document.getElementById('failedTestsList');
            
            if (failedTests.length > 0) {
                failedTestsList.innerHTML = '';
                failedTests.forEach(test => {
                    const li = document.createElement('li');
                    li.textContent = test;
                    failedTestsList.appendChild(li);
                });
                failedTestsSection.style.display = 'block';
            } else {
                failedTestsSection.style.display = 'none';
            }
            
            // æ—¢å­˜ã®çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’å‰Šé™¤
            const existingLink = document.getElementById('resultFileLink');
            if (existingLink) {
                existingLink.remove();
            }
            
            // çµæœãƒ•ã‚¡ã‚¤ãƒ«ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤º
            if (resultFilePath) {
                const filename = resultFilePath.split('/').pop();
                const resultFileContainer = document.createElement('div');
                resultFileContainer.id = 'resultFileLink';
                resultFileContainer.style.marginTop = '15px';
                resultFileContainer.style.padding = '15px';
                resultFileContainer.style.background = 'linear-gradient(135deg, #f8f9fa, #e9ecef)';
                resultFileContainer.style.border = '2px solid #007bff';
                resultFileContainer.style.borderRadius = '10px';
                resultFileContainer.style.textAlign = 'center';
                
                const linkTitle = document.createElement('h4');
                linkTitle.textContent = 'ğŸ“„ ãƒ†ã‚¹ãƒˆçµæœãƒ•ã‚¡ã‚¤ãƒ«';
                linkTitle.style.margin = '0 0 10px 0';
                linkTitle.style.color = '#0056b3';
                linkTitle.style.fontSize = '1rem';
                
                const resultFileLink = document.createElement('a');
                resultFileLink.href = `/api/results/${filename}`;
                resultFileLink.textContent = `ğŸ“ ${filename}`;
                resultFileLink.style.display = 'inline-block';
                resultFileLink.style.marginTop = '5px';
                resultFileLink.style.textDecoration = 'none';
                resultFileLink.style.color = 'white';
                resultFileLink.style.padding = '10px 20px';
                resultFileLink.style.background = 'linear-gradient(135deg, #007bff, #0056b3)';
                resultFileLink.style.borderRadius = '8px';
                resultFileLink.style.transition = 'all 0.3s ease';
                resultFileLink.style.fontWeight = '600';
                
                resultFileLink.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 4px 12px rgba(0, 123, 255, 0.3)';
                });
                
                resultFileLink.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                });
                
                resultFileContainer.appendChild(linkTitle);
                resultFileContainer.appendChild(resultFileLink);
                document.getElementById('testSummary').appendChild(resultFileContainer);
                
                addLog(`ğŸ“ çµæœãƒ•ã‚¡ã‚¤ãƒ«: ${filename} ã¸ã®ãƒªãƒ³ã‚¯ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ`);
            }
            
            // ã‚µãƒãƒªãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡¨ç¤º
            document.getElementById('testSummary').style.display = 'block';
            
            addLog(`ğŸ“Š ãƒ†ã‚¹ãƒˆçµæœã‚µãƒãƒªãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã¾ã—ãŸ`);
        }

        // AIè¨­å®šé–¢æ•°
        function updateTemperatureDisplay() {
            const temperature = document.getElementById('aiTemperature').value;
            document.getElementById('temperatureValue').textContent = temperature;
        }
        
        function updateTopPDisplay() {
            const topP = document.getElementById('aiTopP').value;
            document.getElementById('topPValue').textContent = topP;
        }
        
        function loadAIConfig(config) {
            if (config.openai) {
                document.getElementById('aiModel').value = config.openai.model || 'gpt-4o-mini';
                document.getElementById('aiTemperature').value = config.openai.temperature || 0.5;
                document.getElementById('aiMaxTokens').value = config.openai.max_tokens || 4000;
                document.getElementById('aiTopP').value = config.openai.top_p || 0.9;
                updateTemperatureDisplay();
                updateTopPDisplay();
            }
        }
        
        async function saveAIConfig() {
            const aiConfig = {
                model: document.getElementById('aiModel').value,
                temperature: parseFloat(document.getElementById('aiTemperature').value),
                max_tokens: parseInt(document.getElementById('aiMaxTokens').value),
                top_p: parseFloat(document.getElementById('aiTopP').value)
            };
            
            try {
                const response = await fetch('/api/config/ai', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(aiConfig)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('ğŸ’¾ AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    showStatus('AIè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                } else {
                    addLog(`âŒ AIè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    showStatus('AIè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                addLog(`âŒ AIè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatus('AIè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        function resetAIConfig() {
            document.getElementById('aiModel').value = 'gpt-4o-mini';
            document.getElementById('aiTemperature').value = 0.5;
            document.getElementById('aiMaxTokens').value = 4000;
            document.getElementById('aiTopP').value = 0.9;
            updateTemperatureDisplay();
            updateTopPDisplay();
            addLog('ğŸ”„ AIè¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ');
            showStatus('AIè¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ', 'info');
        }

        // Google Sheetsè¨­å®šé–¢æ•°
        async function saveGoogleSheetsConfig() {
            const sheetsConfig = {
                shareEmail: document.getElementById('shareEmail').value,
                driveFolder: document.getElementById('driveFolder').value,
                spreadsheetTitle: document.getElementById('spreadsheetTitle').value,
                autoUpload: document.getElementById('autoUpload').checked
            };
            
            try {
                const response = await fetch('/api/config/sheets', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(sheetsConfig)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog('ğŸ’¾ Google Sheetsè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ');
                    showStatus('Google Sheetsè¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                } else {
                    addLog(`âŒ Google Sheetsè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    showStatus('Google Sheetsè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                addLog(`âŒ Google Sheetsè¨­å®šä¿å­˜ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatus('Google Sheetsè¨­å®šã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        async function testGoogleSheetsConnection() {
            const shareEmail = document.getElementById('shareEmail').value;
            const driveFolder = document.getElementById('driveFolder').value;
            
            if (!shareEmail) {
                showStatus('å…±æœ‰ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }
            
            try {
                addLog('ğŸ”— Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...');
                showStatus('Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆä¸­...', 'info');
                
                const response = await fetch('/api/sheets/test', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        shareEmail: shareEmail,
                        driveFolder: driveFolder
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    addLog(`âœ… Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸ`);
                    addLog(`ğŸ“Š ãƒ†ã‚¹ãƒˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ: ${result.spreadsheetUrl}`);
                    showStatus('Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼', 'success');
                    
                    // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã§URLã‚’è¡¨ç¤º
                    const openSheet = confirm(`Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆæˆåŠŸï¼\n\nãƒ†ã‚¹ãƒˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚’é–‹ãã¾ã™ã‹ï¼Ÿ\n${result.spreadsheetUrl}`);
                    if (openSheet) {
                        window.open(result.spreadsheetUrl, '_blank');
                    }
                } else {
                    addLog(`âŒ Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${result.error}`);
                    showStatus('Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
                }
            } catch (error) {
                addLog(`âŒ Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆã‚¨ãƒ©ãƒ¼: ${error.message}`);
                showStatus('Google Sheetsæ¥ç¶šãƒ†ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸ', 'error');
            }
        }
        
        function loadGoogleSheetsConfig(config) {
            if (config.googleSheets) {
                document.getElementById('shareEmail').value = config.googleSheets.shareEmail || 'sakata1977@gmail.com';
                document.getElementById('driveFolder').value = config.googleSheets.driveFolder || '';
                document.getElementById('spreadsheetTitle').value = config.googleSheets.spreadsheetTitle || 'AutoPlaywright ãƒ†ã‚¹ãƒˆçµæœ';
                document.getElementById('autoUpload').checked = config.googleSheets.autoUpload !== false;
            }
        }

        // æ‰‹å‹•ã‚¬ã‚¤ãƒ‰ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showManualGuide() {
            document.getElementById('manualGuideModal').style.display = 'block';
            addLog('ğŸ“‹ æ‰‹å‹•ãƒ†ã‚¹ãƒˆã‚·ãƒŠãƒªã‚ªä½œæˆã‚¬ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã¾ã—ãŸ');
        }
        
        // ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeModal(event) {
            if (!event || event.target === event.currentTarget) {
                document.getElementById('manualGuideModal').style.display = 'none';
                addLog('ğŸ“‹ ã‚¬ã‚¤ãƒ‰ã‚’é–‰ã˜ã¾ã—ãŸ');
            }
        }
        
        // ESCã‚­ãƒ¼ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                closeModal();
            }
        });

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            addLog('ğŸ‰ AutoPlaywright WebUI ãŒæº–å‚™å®Œäº†ã—ã¾ã—ãŸ');
            
            // ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ 
            document.getElementById('aiTemperature').addEventListener('input', updateTemperatureDisplay);
            document.getElementById('aiTopP').addEventListener('input', updateTopPDisplay);
            
            // config.jsonã‹ã‚‰ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã‚’èª­ã¿è¾¼ã¿
            fetch('/api/config')
                .then(response => response.json())
                .then(config => {
                    if (config.targetUrl) {
                        document.getElementById('testUrl').value = config.targetUrl;
                        addLog(`ğŸ“‹ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆURLèª­ã¿è¾¼ã¿: ${config.targetUrl}`);
                    }
                    
                    // AIè¨­å®šã‚’èª­ã¿è¾¼ã¿
                    loadAIConfig(config);
                    addLog(`ğŸ¤– AIè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
                    
                    // Google Sheetsè¨­å®šã‚’èª­ã¿è¾¼ã¿
                    loadGoogleSheetsConfig(config);
                    addLog(`ğŸ“ˆ Google Sheetsè¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ`);
                })
                .catch(error => {
                    addLog(`âš ï¸ è¨­å®šèª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`);
                });
        });
    </script>
</body>
</html> 